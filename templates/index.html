<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="ICU 麻醉信息化项目全周期管理平台 - 高效交付专家">
    <link rel="manifest" href="/api/force_static/manifest.json">
    <link rel="apple-touch-icon" href="/api/force_static/icons/icon-192.png">
    <title>重症手麻项目管理系统 V2.0 - 高效交付专家</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="/api/force_static/js/modules/interface-spec.js?v=9"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --primary-dark: #3730a3;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --pink: #ec4899;
            --cyan: #06b6d4;
            --gray-50: #f9fafb;
            --gray-100: #f1f5f9;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --sidebar-width: 300px;
            --card-bg: #ffffff;
            --secondary: #8b5cf6;
            --header-bg: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        [data-theme="dark"] {
            --gray-50: #1e293b;
            --gray-100: #0f172a;
            --gray-200: #334155;
            --gray-300: #475569;
            --gray-400: #94a3b8;
            --gray-500: #cbd5e1;
            --gray-600: #e2e8f0;
            --gray-700: #f1f5f9;
            --gray-800: #f8fafc;
            --gray-900: #ffffff;
            --card-bg: rgba(30, 41, 59, 0.8);
            --header-bg: linear-gradient(135deg, #1e1b4b 0%, #0f172a 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
            color: var(--gray-800);
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        /* ========== Header ========== */
        .header {
            background: var(--header-bg);
            color: white;
            padding: 0 20px;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: background 0.3s;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .logo {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .header-title h1 {
            font-size: 16px;
            font-weight: 600;
        }

        .header-title p {
            font-size: 11px;
            opacity: 0.8;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .header-btn .btn-text {
            display: inline;
        }

        .notification-badge {
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* ========== Main Layout ========== */
        .main-container {
            display: flex;
            margin-top: 60px;
            height: calc(100vh - 60px);
        }

        /* ========== Sidebar ========== */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            position: fixed;
            top: 60px;
            left: 0;
            bottom: 0;
            z-index: 90;
            transition: transform 0.3s ease;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 85;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            font-size: 15px;
            font-weight: 600;
        }

        .sidebar-filter {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .sidebar-filter select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 13px;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            -webkit-overflow-scrolling: touch;
        }

        .project-card {
            padding: 14px;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            position: relative;
        }

        .project-card:hover,
        .project-card:active {
            border-color: var(--primary-light);
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);
        }

        .project-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05), rgba(129, 140, 248, 0.05));
        }

        .project-card.status-暂停,
        .project-card.status-离场待返 {
            border-left: 4px solid var(--pink);
        }

        .project-card.status-已终止 {
            border-left: 4px solid var(--danger);
            opacity: 0.7;
        }

        .project-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .project-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 14px;
            line-height: 1.3;
        }

        .project-status {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .status-待启动 {
            background: #f3f4f6;
            color: #6b7280;
        }

        .status-进行中 {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .status-试运行 {
            background: #ede9fe;
            color: #7c3aed;
        }

        .status-验收中 {
            background: #fef3c7;
            color: #b45309;
        }

        .status-已验收 {
            background: #d1fae5;
            color: #047857;
        }

        .status-质保期 {
            background: #cffafe;
            color: #0891b2;
        }

        .status-暂停 {
            background: #ffedd5;
            color: #c2410c;
        }

        .status-离场待返 {
            background: #fce7f3;
            color: #be185d;
        }

        .status-已终止 {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-已完成 {
            background: #d1fae5;
            color: #047857;
        }

        .project-hospital {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 10px;
        }

        .project-progress {
            height: 5px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }

        .project-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 3px;
            transition: width 0.3s;
        }

        .project-progress-text {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 6px;
            display: flex;
            justify-content: space-between;
        }

        /* 风险与逾期角标 */
        .card-alert-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .card-risk-indicator {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            font-size: 10px;
            padding: 1px 5px;
            border-radius: 4px;
            margin-left: 5px;
        }

        .risk-high {
            background: #fee2e2;
            color: #dc2626;
        }

        .risk-medium {
            background: #fef3c7;
            color: #b45309;
        }

        .risk-low {
            background: #dcfce7;
            color: #16a34a;
        }


        /* ========== Main Content ========== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            overflow-y: auto;
            padding: 20px;
            background: var(--gray-50);
            -webkit-overflow-scrolling: touch;
        }

        /* ========== Dashboard ========== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 12px;
        }

        .stat-icon.blue {
            background: #dbeafe;
        }

        .stat-icon.green {
            background: #d1fae5;
        }

        .stat-icon.yellow {
            background: #fef3c7;
        }

        .stat-icon.red {
            background: #fee2e2;
        }

        .stat-icon.pink {
            background: #fce7f3;
        }

        .stat-icon.purple {
            background: #ede9fe;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .stat-label {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        /* ========== Panel ========== */
        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .panel-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-body {
            padding: 20px;
        }

        /* ========== Report Styles ========== */
        .report-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #374151;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .report-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
        }

        .report-header.ai-report {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #bfdbfe;
        }

        .report-header.weekly-report {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #bbf7d0;
        }

        .report-header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .report-header-title h2 {
            font-size: 24px;
            color: #1e293b;
            font-weight: 700;
            margin: 0;
        }

        .report-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .report-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #64748b;
            background: rgba(255, 255, 255, 0.8);
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .overview-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: transform 0.2s;
        }

        .overview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .overview-card-title {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 8px;
        }

        .overview-card-value {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
        }

        /* Cache Hint */
        .cache-hint {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            color: #c2410c;
            padding: 10px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Markdown Report Content */
        .report-content {
            font-size: 15px;
        }

        .report-content h1,
        .report-content h2,
        .report-content h3 {
            color: #1e293b;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            font-weight: 700;
        }

        .report-content h3 {
            font-size: 18px;
            border-left: 4px solid var(--primary);
            padding-left: 12px;
            display: flex;
            align-items: center;
        }

        .report-content p {
            margin-bottom: 1em;
            color: #4b5563;
            line-height: 1.7;
        }

        .report-content ul,
        .report-content ol {
            padding-left: 20px;
            margin-bottom: 1em;
            color: #4b5563;
        }

        .report-content li {
            margin-bottom: 0.5em;
        }

        .report-content blockquote {
            border-left: 4px solid #e2e8f0;
            padding-left: 16px;
            color: #64748b;
            background: #f8fafc;
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            margin: 1.5em 0;
        }

        .report-content strong {
            color: #1e293b;
            font-weight: 600;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-pink {
            background: var(--pink);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-ai {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-xs {
            padding: 4px 8px;
            font-size: 11px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ========== Tabs ========== */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--gray-100);
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 10px 16px;
            cursor: pointer;
            border-radius: 8px;
            color: var(--gray-600);
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ========== Table ========== */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-100);
            font-size: 13px;
        }

        .table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-700);
            white-space: nowrap;
        }

        .table tr:hover {
            background: var(--gray-50);
        }

        /* ========== Badge ========== */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .badge-success {
            background: #d1fae5;
            color: #047857;
        }

        .badge-warning {
            background: #fef3c7;
            color: #b45309;
        }

        .badge-danger {
            background: #fee2e2;
            color: #dc2626;
        }

        .badge-info {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .badge-gray {
            background: var(--gray-200);
            color: var(--gray-600);
        }

        .badge-pink {
            background: #fce7f3;
            color: #be185d;
        }

        .badge-purple {
            background: #ede9fe;
            color: #7c3aed;
        }

        /* ========== Modal ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 560px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalIn 0.2s ease-out;
            display: flex;
            flex-direction: column;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-content.modal-large {
            max-width: 800px;
        }

        .modal-content.modal-xl {
            max-width: 1200px;
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--gray-100);
            cursor: pointer;
            font-size: 18px;
            color: var(--gray-500);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            -webkit-overflow-scrolling: touch;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-100);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: var(--gray-50);
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        /* ========== Toast ========== */
        .toast-container {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            color: var(--gray-800);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            max-width: 400px;
            pointer-events: auto;
            animation: toastIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(30px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .toast.fade-out {
            animation: toastOut 0.3s ease-in forwards;
        }

        @keyframes toastOut {
            to {
                opacity: 0;
                transform: translateX(30px) scale(0.9);
            }
        }

        /* ========== Form ========== */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .form-section {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .form-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* ========== Stage Accordion ========== */
        .stage-item {
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .stage-header {
            padding: 12px 16px;
            background: var(--gray-50);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            gap: 16px;
        }

        .stage-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .stage-arrow {
            transition: transform 0.2s;
            color: var(--gray-400);
            flex-shrink: 0;
            font-size: 10px;
        }

        .stage-item.expanded .stage-arrow {
            transform: rotate(90deg);
        }

        .stage-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 14px;
        }

        .stage-color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .stage-progress-mini {
            width: 80px;
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .stage-progress-mini-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .stage-dates {
            font-size: 11px;
            color: var(--gray-500);
            flex-shrink: 0;
        }

        .stage-body {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            background: #fff;
        }

        .stage-item.expanded .stage-body {
            padding: 12px 16px 16px 42px;
            max-height: 2000px;
            border-top: 1px solid var(--gray-200);
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 10px 14px;
            background: var(--gray-50);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--gray-300);
            margin-right: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }

        .task-checkbox.checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
        }

        .task-name {
            flex: 1;
            font-size: 13px;
            color: var(--gray-700);
        }

        .task-name.completed {
            text-decoration: line-through;
            color: var(--gray-400);
        }

        /* ========== Detail Header ========== */
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            gap: 16px;
            flex-wrap: wrap;
        }

        .detail-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .detail-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: var(--gray-600);
        }

        /* ========== Overview Cards ========== */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 14px;
            margin-bottom: 20px;
        }

        .overview-card {
            background: var(--gray-50);
            border-radius: 10px;
            padding: 16px;
        }

        .overview-card-title {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .overview-card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .overview-card-value.progress-text {
            color: var(--primary);
        }

        /* ========== Loading ========== */
        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: var(--primary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ========== Empty State ========== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 15px;
            margin-bottom: 6px;
        }

        .empty-state-hint {
            font-size: 13px;
            color: var(--gray-400);
        }

        /* ========== 离场卡片 ========== */
        .departure-card {
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            background: white;
        }

        .departure-card.type-计划离场 {
            border-left: 4px solid var(--success);
        }

        .departure-card.type-临时离场 {
            border-left: 4px solid var(--warning);
        }

        .departure-card.type-项目暂停 {
            border-left: 4px solid var(--pink);
        }

        .departure-card.type-项目终止 {
            border-left: 4px solid var(--danger);
        }

        .departure-card.type-验收离场 {
            border-left: 4px solid var(--info);
        }

        .departure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .departure-type {
            font-weight: 600;
            font-size: 14px;
        }

        .departure-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            font-size: 13px;
            color: var(--gray-600);
        }

        .departure-info-item span {
            font-weight: 500;
            color: var(--gray-800);
        }

        .handover-checklist {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-100);
        }

        .handover-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .handover-item.done {
            color: var(--success);
        }

        .handover-item.pending {
            color: var(--gray-400);
        }

        /* ========== 人员卡片 ========== */
        .member-card {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            margin-bottom: 10px;
            gap: 12px;
        }

        .member-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
        }

        .member-info {
            flex: 1;
            min-width: 0;
        }

        .member-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
        }

        .member-role {
            font-size: 12px;
            color: var(--gray-500);
        }

        .member-contact {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 2px;
        }

        .member-status {
            flex-shrink: 0;
        }

        /* ========== 工时日志 ========== */
        .worklog-item {
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 10px;
        }

        .worklog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .worklog-date {
            font-weight: 600;
            font-size: 14px;
        }

        .worklog-meta {
            font-size: 12px;
            color: var(--gray-500);
        }

        .worklog-content {
            font-size: 13px;
            color: var(--gray-700);
            line-height: 1.6;
        }

        /* ========== 费用项 ========== */
        .expense-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
            gap: 12px;
        }

        .expense-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .expense-icon.差旅 {
            background: #dbeafe;
        }

        .expense-icon.住宿 {
            background: #fef3c7;
        }

        .expense-icon.餐饮 {
            background: #d1fae5;
        }

        .expense-icon.交通 {
            background: #ede9fe;
        }

        .expense-icon.采购 {
            background: #fce7f3;
        }

        .expense-icon.其他 {
            background: var(--gray-100);
        }

        .expense-info {
            flex: 1;
        }

        .expense-desc {
            font-size: 14px;
            font-weight: 500;
        }

        .expense-meta {
            font-size: 12px;
            color: var(--gray-500);
        }

        .expense-amount {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
        }

        /* ========== 满意度星星 ========== */
        .star-rating {
            display: flex;
            gap: 4px;
        }

        .star {
            font-size: 20px;
            color: var(--gray-300);
            cursor: pointer;
            transition: color 0.2s;
        }

        .star.active {
            color: #fbbf24;
        }

        .star:hover {
            color: #f59e0b;
        }

        /* ========== 甘特图图例 ========== */
        .gantt-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            padding: 12px 16px;
            background: var(--gray-50);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .gantt-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--gray-600);
        }

        .gantt-legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }

        /* ========== Chart Container ========== */
        .gantt-chart-container {
            width: 100%;
            height: 400px;
            min-height: 300px;
            overflow-x: auto;
        }

        .global-gantt-container {
            width: 100%;
            height: 500px;
            overflow-x: auto;
        }

        .burndown-chart {
            height: 350px;
            width: 100%;
        }

        .chart-container {
            width: 100%;
            height: 300px;
        }

        /* ========== 响应式 ========== */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .overview-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .departure-info {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            :root {
                --sidebar-width: 280px;
            }

            .menu-toggle {
                display: block;
            }

            .header-title p {
                display: none;
            }

            .header-btn .btn-text {
                display: none;
            }

            .header-btn {
                padding: 8px 10px;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay.show {
                display: block;
            }

            .main-content {
                margin-left: 0;
                padding: 16px;
            }

            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .overview-grid {
                grid-template-columns: 1fr 1fr;
            }

            .detail-header {
                flex-direction: column;
            }

            .detail-title {
                font-size: 18px;
            }

            .btn-group {
                width: 100%;
            }

            .btn-group .btn {
                flex: 1;
                justify-content: center;
            }

            .tabs {
                margin: 0 -16px 16px;
                padding: 4px 16px;
                border-radius: 0;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-row-3 {
                grid-template-columns: 1fr;
            }

            .departure-info {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-height: 95vh;
                border-radius: 12px 12px 0 0;
                margin-top: auto;
            }

            .modal {
                align-items: flex-end;
                padding: 0;
            }

            .modal-content.modal-large,
            .modal-content.modal-xl {
                max-width: 100%;
            }

            .gantt-chart-container {
                height: 300px;
            }

            .global-gantt-container {
                height: 400px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 12px;
            }

            .logo {
                display: none;
            }

            .header-title h1 {
                font-size: 14px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .stat-card {
                padding: 12px;
            }

            .stat-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }

            .stat-value {
                font-size: 20px;
            }

            .panel-body {
                padding: 14px;
            }

            .table th,
            .table td {
                padding: 10px 8px;
                font-size: 12px;
            }

            .overview-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* ========== Scrollbar ========== */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 3px;
        }

        @media (hover: none) {
            ::-webkit-scrollbar {
                display: none;
            }
        }

        /* ========== 提醒样式 ========== */
        .reminder-item {
            display: flex;
            align-items: flex-start;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid;
            gap: 12px;
        }

        .reminder-item.info {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .reminder-item.warning {
            background: #fffbeb;
            border-color: #f59e0b;
        }

        .reminder-item.danger {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .reminder-content {
            flex: 1;
            min-width: 0;
        }

        .reminder-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .reminder-desc {
            font-size: 13px;
            color: var(--gray-600);
        }

        .reminder-time {
            font-size: 11px;
            color: var(--gray-400);
            margin-top: 6px;
        }

        /* ========== 里程碑 ========== */
        .milestone-item {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            margin-bottom: 10px;
            gap: 12px;
        }

        .milestone-diamond {
            width: 12px;
            height: 12px;
            background: var(--warning);
            transform: rotate(45deg);
            flex-shrink: 0;
            cursor: pointer;
        }

        .milestone-diamond.completed {
            background: var(--success);
        }

        .milestone-info {
            flex: 1;
            min-width: 0;
        }

        .milestone-name {
            font-weight: 500;
            color: var(--gray-800);
            font-size: 14px;
        }

        .milestone-date {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* ========== 项目进度行 ========== */
        .project-progress-row {
            display: flex;
            align-items: center;
            padding: 14px;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            gap: 12px;
        }

        .project-progress-row:hover {
            background: var(--gray-50);
        }

        .progress-project-name {
            width: 160px;
            font-weight: 500;
            font-size: 13px;
            flex-shrink: 0;
        }

        .progress-hospital {
            width: 120px;
            font-size: 12px;
            color: var(--gray-500);
            flex-shrink: 0;
        }

        .progress-bar-container {
            flex: 1;
            min-width: 100px;
        }

        .progress-bar-track {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 4px;
        }

        .progress-bar-fill.low {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        .progress-bar-fill.medium {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        .progress-bar-fill.high {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .progress-percent {
            width: 50px;
            text-align: right;
            font-weight: 600;
            font-size: 13px;
        }

        .progress-status {
            width: 70px;
            text-align: center;
        }

        /* ========== 报告样式 ========== */
        .report-container {
            background: white;
        }

        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .report-header.ai-report {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
        }

        .report-header.weekly-report {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .report-header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .report-header-title .icon {
            font-size: 32px;
        }

        .report-header-title h2 {
            font-size: 24px;
            font-weight: 700;
        }

        .report-meta {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            font-size: 14px;
            opacity: 0.9;
        }

        .report-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .score-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .score-card.score-high {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #86efac;
        }

        .score-card.score-medium {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-color: #fcd34d;
        }

        .score-card.score-low {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #fca5a5;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .score-value {
            font-size: 32px;
            font-weight: 800;
            line-height: 1;
        }

        .score-card.score-high .score-value {
            color: #10b981;
        }

        .score-card.score-medium .score-value {
            color: #f59e0b;
        }

        .score-card.score-low .score-value {
            color: #ef4444;
        }

        .score-label {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .score-info {
            flex: 1;
        }

        .score-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .score-desc {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.6;
        }

        .report-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .report-section-header {
            background: var(--gray-50);
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-section-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .report-section-icon.risk {
            background: #fee2e2;
        }

        .report-section-icon.suggestion {
            background: #d1fae5;
        }

        .report-section-icon.focus {
            background: #dbeafe;
        }

        .report-section-icon.progress {
            background: #fef3c7;
        }

        .report-section-icon.issue {
            background: #fce7f3;
        }

        .report-section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .report-section-body {
            padding: 20px;
        }

        .report-section-body ul,
        .report-section-body ol {
            padding-left: 20px;
        }

        .report-section-body li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .report-section-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
        }

        .report-section-body table th,
        .report-section-body table td {
            padding: 10px 12px;
            border: 1px solid var(--gray-200);
            text-align: left;
            font-size: 13px;
        }

        .report-section-body table th {
            background: var(--gray-50);
            font-weight: 600;
        }

        .cache-hint {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: #166534;
        }

        .cache-hint .icon {
            font-size: 18px;
        }

        /* ========== 报告概览增强样式 ========== */
        .report-overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .overview-card-v2 {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .overview-card-v2:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-color: var(--primary-light);
        }

        .overview-card-v2 .card-icon {
            width: 44px;
            height: 44px;
            background: var(--gray-50);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .overview-card-v2 .card-content {
            flex: 1;
            min-width: 0;
        }

        .overview-card-v2 .card-label {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 2px;
        }

        .overview-card-v2 .card-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-800);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .progress-mini-track {
            height: 4px;
            background: var(--gray-100);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-mini-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 2px;
        }

        /* ========== 状态流转 ========== */
        .status-flow {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .status-flow-item {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .status-flow-item:hover {
            transform: scale(1.05);
        }

        .status-flow-item.current {
            border-color: var(--primary);
        }

        .status-flow-item.available {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .status-flow-arrow {
            color: var(--gray-400);
            font-size: 16px;
        }

        /* ========== 知识库网格 ========== */
        .kb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .kb-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .kb-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            border-color: var(--primary-light);
        }

        .kb-card-tag {
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 0 0 0 12px;
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .kb-card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--gray-800);
            padding-right: 60px;
        }

        .kb-card-content {
            font-size: 13px;
            color: var(--gray-600);
            line-height: 1.6;
            display: -webkit-box;
            overflow: hidden;
            margin-bottom: 14px;
        }

        .kb-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 14px;
            border-top: 1px solid var(--gray-100);
            font-size: 11px;
            color: var(--gray-400);
        }

        .kb-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .tag-pill {
            padding: 2px 8px;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            color: var(--gray-500);
        }

        /* ========== 资产统计卡片 ========== */
        .asset-stat-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
        }

        .asset-stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .asset-stat-info h4 {
            font-size: 12px;
            color: var(--gray-500);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .asset-stat-info p {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
        }

        /* ========== 项目健康度仪表盘 ========== */
        .health-dashboard {
            padding: 16px;
        }

        .health-summary {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .health-stat {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            background: white;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .health-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .health-stat-label {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .health-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }

        .health-card {
            background: white;
            border-radius: 10px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--gray-200);
        }

        .health-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .health-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .health-card-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
        }

        .health-score {
            font-weight: 700;
            font-size: 13px;
        }

        .health-card-meta {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 8px;
        }

        .health-metrics {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--gray-600);
        }

        .health-metrics span {
            display: flex;
            align-items: center;
            gap: 3px;
        }
    </style>
</head>
<!-- 接口文档上传解析弹窗 -->
<div id="specUploadModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="specUploadTitle">上传接口文档</h3>
            <button class="modal-close" onclick="closeModal('specUploadModal')">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>选择文件（PDF / Word / TXT / XML / JSON）</label>
                <input type="file" id="specFileInput" accept=".pdf,.doc,.docx,.txt,.xml,.json,.wsdl"
                    onchange="InterfaceSpec.handleFileSelect()" style="width:100%;">
            </div>
            <div class="form-group" id="specCategoryGroup">
                <label>分类</label>
                <select id="specCategory" class="form-control">
                    <option value="手麻标准">手麻标准</option>
                    <option value="重症标准">重症标准</option>
                    <option value="接口文档">接口文档</option>
                </select>
            </div>
            <div class="form-group" id="specVendorNameGroup" style="display:none;">
                <label>厂家/系统名称</label>
                <input type="text" id="specVendorName" class="form-control" placeholder="如：东华HIS、卫宁LIS...">
            </div>
            <div class="form-group">
                <label>文档内容（粘贴或由上方文件自动提取）</label>
                <textarea id="specDocText" class="form-control" rows="12" placeholder="将接口文档内容粘贴到此处..."></textarea>
            </div>
            <div id="specParseResult" style="display:none;"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('specUploadModal')">取消</button>
            <button class="btn btn-ai" id="btnSpecParse" onclick="InterfaceSpec.submitParse()">🤖 开始 AI 解析</button>
        </div>
    </div>
</div>

<!-- 字段对照详情弹窗 -->
<div id="fieldDetailModal" class="modal">
    <div class="modal-content modal-xl">
        <div class="modal-header">
            <h3>字段级对照详情</h3>
            <button class="modal-close" onclick="closeModal('fieldDetailModal')">×</button>
        </div>
        <div class="modal-body" id="fieldDetailBody">
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('fieldDetailModal')">关闭</button>
        </div>
    </div>
</div>
<!-- 接口文档上传解析弹窗 -->
<div id="specUploadModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="specUploadTitle">上传接口文档</h3>
            <button class="modal-close" onclick="closeModal('specUploadModal')">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>选择文件（PDF / Word / TXT / XML / JSON）</label>
                <input type="file" id="specFileInput" accept=".pdf,.doc,.docx,.txt,.xml,.json,.wsdl"
                    onchange="InterfaceSpec.handleFileSelect()" style="width:100%;">
            </div>
            <div class="form-group" id="specCategoryGroup">
                <label>分类</label>
                <select id="specCategory" class="form-control">
                    <option value="手麻标准">手麻标准</option>
                    <option value="重症标准">重症标准</option>
                    <option value="接口文档">接口文档</option>
                </select>
            </div>
            <div class="form-group" id="specVendorNameGroup" style="display:none;">
                <label>厂家/系统名称</label>
                <input type="text" id="specVendorName" class="form-control" placeholder="如：东华HIS、卫宁LIS...">
            </div>
            <div class="form-group">
                <label>文档内容（粘贴或由上方文件自动提取）</label>
                <textarea id="specDocText" class="form-control" rows="12" placeholder="将接口文档内容粘贴到此处..."></textarea>
            </div>
            <div id="specParseResult" style="display:none;"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('specUploadModal')">取消</button>
            <button class="btn btn-ai" id="btnSpecParse" onclick="InterfaceSpec.submitParse()">🤖 开始 AI 解析</button>
        </div>
    </div>
</div>

<!-- 字段对照详情弹窗 -->
<div id="fieldDetailModal" class="modal">
    <div class="modal-content modal-xl">
        <div class="modal-header">
            <h3>字段级对照详情</h3>
            <button class="modal-close" onclick="closeModal('fieldDetailModal')">×</button>
        </div>
        <div class="modal-body" id="fieldDetailBody">
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeModal('fieldDetailModal')">关闭</button>
        </div>
    </div>
</div>

<body>
    <!-- Header -->

    <div class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
            <div class="logo">🏥</div>
            <div class="header-title">
                <h1>重症手麻项目管理 V2.0</h1>
                <p>ICU & Anesthesia Project Management</p>
            </div>
        </div>
        <div class="header-right" style="display:flex; align-items:center; gap:12px;">
            <button class="header-btn"
                style="background:rgba(255,255,255,0.15); border:none; color:white; border-radius:50%; width:34px; height:34px; padding:0; justify-content:center;"
                onclick="toggleTheme()" title="切换深色/浅色模式">🌓</button>
            <button class="header-btn" onclick="showDashboard()">📊 <span class="btn-text">仪表盘</span></button>
            <button class="header-btn" onclick="showGlobalGanttModal()">📅 <span class="btn-text">总览</span></button>
            <button class="header-btn" onclick="generateAllReport()">📋 <span class="btn-text">周报</span></button>
            <button class="header-btn" onclick="openPmoDashboard()"
                style="background:linear-gradient(135deg,rgba(16,185,129,0.4),rgba(5,150,105,0.4));">🧭 <span
                    class="btn-text">PMO 决策舱</span></button>
            <button class="header-btn" onclick="showGlobalBriefingPanel()"
                style="background:linear-gradient(135deg,rgba(139,92,246,0.4),rgba(99,102,241,0.4));">📋 <span
                    class="btn-text">晨会简报</span></button>
            <button class="header-btn" onclick="showNotificationsModal()">
                🔔 <span class="notification-badge" id="notifBadge" style="display:none;">0</span>
            </button>
            <button class="header-btn" id="loginBtn" onclick="toggleUserPanel()"
                style="background:rgba(255,255,255,0.2);">
                👤 <span class="btn-text" id="loginBtnText">登录</span>
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>项目列表</h2>
                <button class="btn btn-primary btn-sm" onclick="showAddProjectModal()">+ 新建</button>
            </div>
            <div class="sidebar-filter">
                <select id="statusFilter" onchange="filterProjects()">
                    <option value="">全部状态</option>
                    <option value="进行中">进行中</option>
                    <option value="试运行">试运行</option>
                    <option value="验收中">验收中</option>
                    <option value="暂停">暂停</option>
                    <option value="离场待返">离场待返</option>
                    <option value="已验收">已验收</option>
                    <option value="质保期">质保期</option>
                    <option value="已完成">已完成</option>
                </select>
            </div>
            <div class="sidebar-content" id="projectList">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>加载中...</p>
                </div>
            </div>
            <div class="sidebar-footer"
                style="padding: 0; border-top: 1px solid var(--gray-200); display: flex; flex-direction: column;">

                <!-- 功能菜单折叠头 -->
                <div onclick="toggleFunctionMenu()"
                    style="padding: 12px 16px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; background: var(--gray-50); border-bottom: 1px solid var(--gray-200);">
                    <span style="font-weight: 600; font-size: 13px; color: var(--gray-700);">功能菜单</span>
                    <span id="menuToggleIcon" style="font-size: 12px; transition: transform 0.2s;">▸</span>
                </div>

                <!-- 折叠内容 -->
                <div id="functionMenuContent"
                    style="display: none; padding: 12px; gap: 8px; flex-direction: column; background: white; border-bottom: 1px solid var(--gray-200);">
                    <button class="btn btn-outline btn-full" onclick="toggleHealthDashboard()"
                        style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none;">💚
                        健康度仪表盘</button>
                    <button class="btn btn-outline btn-full" onclick="showWarningCenter()"
                        style="background: linear-gradient(135deg, #ef4444, #f97316); color: white; border: none;">⚠️
                        智能预警 <span id="warningBadge" class="notification-badge" style="display:none;">0</span></button>
                    <button class="btn btn-warning btn-full" onclick="showReminderCenter()">🔔 提醒中心 <span
                            id="reminderBadge" class="notification-badge" style="display:none;">0</span></button>
                    <button class="btn btn-info btn-full" onclick="showDeliveryMap()">🗺️ 交付地图</button>
                    <button class="btn btn-primary btn-full" onclick="showKBView()">📚 知识库</button>
                    <button class="btn btn-success btn-full" onclick="showAssetView()">📦 硬件资产</button>
                    <button class="btn btn-purple btn-full" onclick="showPerformanceAnalytics()">🏅 绩效分析</button>
                    <button class="btn btn-outline btn-full" onclick="showApprovalCenter()">📋 审批中心</button>
                    <button class="btn btn-ai btn-full" onclick="showProjectComparison()">📊 项目对比</button>
                    <button class="btn btn-outline btn-full" onclick="showWecomConfigPanel()"
                        style="background:linear-gradient(135deg,#25d366,#128c7e);color:white;border:none;">📤
                        企微推送配置</button>
                </div>

                <!-- AI 状态 (始终显示) -->
                <div class="ai-status-panel" id="aiStatusPanel"
                    style="margin: 10px; padding: 10px; background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 8px; font-size: 11px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; color: #64748b; font-weight: 600;">
                        <span>🤖 AI 运行状态</span>
                        <span onclick="triggerAiManualHealthCheck(event)" title="手动触发检测"
                            style="cursor: pointer; color: var(--primary); font-size: 14px;">🔄</span>
                    </div>
                    <div id="aiNodeList" style="display: flex; flex-direction: column; gap: 4px;">
                        <div style="color: #94a3b8; text-align: center; padding: 5px;">节点自检中...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div id="dashboardView" style="display:none;"></div>
            <div id="healthDashboard" style="display:none; padding: 20px; background: var(--gray-50);"></div>
            <div id="projectDetailView" style="display:none;"></div>
            <div id="mapView" style="display:none; height: 100%; min-height: 600px;"></div>
            <div id="analyticsView" style="display:none; padding: 20px;"></div>
            <div id="approvalView" style="display:none; padding: 20px;">
                <div class="detail-header" style="margin-bottom: 20px;">
                    <h2 class="detail-title">📋 审批中心</h2>
                    <p class="detail-meta">处理变更申请、离场审核等事项</p>
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">Pending Approvals</div>
                    </div>
                    <div class="panel-body" id="approvalListContainer">
                        <!-- 由 JS 渲染 -->
                    </div>
                </div>
            </div>

            <div id="kbView" style="display:none; padding: 20px;">
                <div class="detail-header" style="margin-bottom: 20px;">
                    <div>
                        <h2 class="detail-title">📚 知识库</h2>
                        <p class="detail-meta">沉淀交付经验、接口技巧与避坑指南</p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="openKBModal()">+ 新增案例</button>
                    </div>
                </div>
                <div class="panel" style="margin-bottom: 20px;">
                    <div class="panel-body">
                        <div class="form-row">
                            <div class="form-group" style="flex:2;">
                                <input type="text" id="kbSearchInput" placeholder="输入关键字搜索标题、内容或标签..."
                                    oninput="searchKB()">
                            </div>
                            <div class="form-group">
                                <select id="kbCategoryFilter" onchange="searchKB()">
                                    <option value="">全部类别</option>
                                    <option value="HIS接口">HIS接口</option>
                                    <option value="硬件设备">硬件设备</option>
                                    <option value="技术方案">技术方案</option>
                                    <option value="避坑指南">避坑指南</option>
                                    <option value="交付经验">交付经验</option>
                                    <option value="系统配置">系统配置</option>
                                    <option value="科室沟通">科室沟通</option>
                                    <option value="其它">其它</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="kb-ai-assistant-panel" id="kbAiAssistant"
                    style="display: flex; flex-direction: column; height: 300px; background: #fdf2f8; border: 2px dashed #f472b6; border-radius: 12px; margin-bottom: 20px; padding: 15px; position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="font-size: 24px;">🧠</span>
                        <div>
                            <h3 style="margin: 0; font-size: 14px; color: #db2777;">AI 交付专家 (基于知识库)</h3>
                            <p style="margin: 0; font-size: 11px; color: #f472b6;">您可以随时向我咨询交付经验</p>
                        </div>
                    </div>
                    <div id="kbAiChatMessages"
                        style="flex: 1; overflow-y: auto; background: white; border-radius: 8px; padding: 10px; font-size: 13px; line-height: 1.5; margin-bottom: 10px; border: 1px solid #fbcfe8;">
                        <div style="color: #999; text-align: center; margin-top: 50px;">输入您想了解的技术难题或交付场景...</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="kbAiQuery" placeholder="例如：HIS接口调用报错如何处理？"
                            style="flex: 1; padding: 8px 12px; border: 1px solid #fbcfe8; border-radius: 6px; font-size: 13px;"
                            onkeyup="if(event.key==='Enter') askKbAi()">
                        <button class="btn btn-purple btn-sm" onclick="askKbAi()">咨询 AI</button>
                    </div>
                </div>

                <div id="kbListContainer" class="kb-grid">
                    <!-- 由 JS 渲染 -->
                </div>
            </div>

            <div id="assetView" style="display:none; padding: 20px;">
                <div class="detail-header" style="margin-bottom: 20px;">
                    <div>
                        <h2 class="detail-title">📦 硬件资产管理</h2>
                        <p class="detail-meta">实时追踪采集盒、网关等设备流转状态</p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="openAssetModal()">+ 登记资产</button>
                    </div>
                </div>
                <div class="overview-grid" id="assetStatsGrid">
                    <!-- 统计卡片 -->
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">资产明细</div>
                        <div class="panel-actions">
                            <select id="assetStatusFilter" class="form-select-sm" onchange="loadAssets()">
                                <option value="">全部状态</option>
                                <option value="在库">在库</option>
                                <option value="现场已安装">现场已安装</option>
                                <option value="在途">在途</option>
                                <option value="返修中">返修中</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>资产名称</th>
                                    <th>SN/序列号</th>
                                    <th>型号</th>
                                    <th>状态</th>
                                    <th>所属项目</th>
                                    <th>当前位置/经手人</th>
                                    <th>最后更新</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="assetTableBody">
                                <!-- 由 JS 渲染 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">📋</div>
                <div class="empty-state-text">请选择一个项目查看详情</div>
                <div class="empty-state-hint">或点击"仪表盘"查看整体项目状态</div>
            </div>
        </div>
    </div>

    <!-- 所有模态框 -->
    <!-- 新建项目模态框 -->
    <div class="modal" id="projectModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="projectModalTitle">新建项目</h3>
                <button class="modal-close" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm">
                    <!-- 模板选择 -->
                    <div class="form-section" id="templateSection">
                        <div class="form-section-title">🎯 选择项目模板</div>
                        <div class="form-group">
                            <select id="projectTemplate" onchange="onTemplateSelect(this.value)"
                                style="padding: 12px; font-size: 14px;">
                                <option value="">-- 不使用模板 (手动配置) --</option>
                                <option value="standard_icu">标准ICU项目 (90天/10阶段)</option>
                                <option value="quick_deploy">快速部署项目 (30天/3阶段)</option>
                                <option value="equipment_upgrade">设备升级项目 (21天/3阶段)</option>
                                <option value="maintenance">运维保障项目 (365天/3阶段)</option>
                            </select>
                        </div>
                        <div id="templatePreview"
                            style="display:none; padding: 12px; background: #f0f9ff; border-radius: 8px; margin-top: 8px; font-size: 13px;">
                            <div id="templatePreviewContent"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">📋 基本信息</div>
                        <div class="form-group">
                            <label>项目名称 *</label>
                            <input type="text" id="projectName" required placeholder="如：XX医院手麻系统实施"
                                oninput="extractHospitalFromProjectName(this.value)">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>医院名称 *</label>
                                <input type="text" id="hospitalName" required placeholder="如：XX市人民医院"
                                    oninput="onHospitalManualInput()">
                            </div>
                            <div class="form-group">
                                <label>合同编号</label>
                                <input type="text" id="contractNo" placeholder="如：HT-2026-001">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>项目经理</label>
                                <input type="text" id="projectManager" placeholder="负责人姓名">
                            </div>
                            <div class="form-group">
                                <label>优先级</label>
                                <select id="projectPriority">
                                    <option value="普通">普通</option>
                                    <option value="重要">重要</option>
                                    <option value="紧急">紧急</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">📅 时间计划</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>计划开始日期</label>
                                <input type="date" id="planStartDate">
                            </div>
                            <div class="form-group">
                                <label>计划结束日期</label>
                                <input type="date" id="planEndDate">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">🏥 项目规模</div>
                        <div class="form-row-3">
                            <div class="form-group">
                                <label>ICU床位数</label>
                                <input type="number" id="icuBeds" placeholder="如: 20" min="0">
                            </div>
                            <div class="form-group">
                                <label>手术间数量</label>
                                <input type="number" id="operatingRooms" placeholder="如: 10" min="0">
                            </div>
                            <div class="form-group">
                                <label>复苏室床位</label>
                                <input type="number" id="pacuBeds" placeholder="如: 8" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">👤 联系信息</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>甲方联系人</label>
                                <input type="text" id="contactPerson">
                            </div>
                            <div class="form-group">
                                <label>联系电话</label>
                                <input type="text" id="contactPhone">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('projectModal')">取消</button>
                <button class="btn btn-primary" onclick="saveProject()">创建项目</button>
            </div>
        </div>
    </div>

    <!-- 状态变更模态框 -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>变更项目状态</h3>
                <button class="modal-close" onclick="closeModal('statusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>新状态</label>
                    <select id="newProjectStatus"
                        style="width:100%; padding:8px; border-radius:4px; border:1px solid #ddd;">
                        <option value="待启动">待启动</option>
                        <option value="进行中">进行中</option>
                        <option value="试运行">试运行</option>
                        <option value="验收中">验收中</option>
                        <option value="已验收">已验收</option>
                        <option value="质保期">质保期</option>
                        <option value="暂停">暂停</option>
                        <option value="已终止">已终止</option>
                        <option value="已完成">已完成</option>
                    </select>
                </div>
                <div style="margin-top:20px; text-align:right;">
                    <button class="btn btn-outline" onclick="closeModal('statusModal')"
                        style="margin-right:10px;">取消</button>
                    <button class="btn btn-primary" onclick="updateProjectStatus()">确认变更</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 离场申请模态框 -->
    <div class="modal" id="departureModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>🚪 离场申请</h3>
                <button class="modal-close" onclick="closeModal('departureModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="departureForm">
                    <div class="form-section">
                        <div class="form-section-title">📋 离场信息</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>离场类型 *</label>
                                <select id="departureType" required>
                                    <option value="计划离场">计划离场（阶段完成）</option>
                                    <option value="临时离场">临时离场（短期外出）</option>
                                    <option value="项目暂停">项目暂停（甲方原因）</option>
                                    <option value="验收离场">验收离场（验收通过）</option>
                                    <option value="项目终止">项目终止</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>离场日期 *</label>
                                <input type="date" id="departureDate" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>预计返场日期</label>
                                <input type="date" id="expectedReturnDate">
                            </div>
                            <div class="form-group">
                                <label>甲方交接人</label>
                                <input type="text" id="handoverPerson" placeholder="甲方接收人姓名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>离场人员</label>
                            <input type="text" id="ourPersons" placeholder="我方离场人员，多人用逗号分隔">
                        </div>
                        <div class="form-group">
                            <label>离场原因</label>
                            <textarea id="departureReason" rows="3" placeholder="请说明离场原因"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">✅ 交接清单</div>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="docHandover"> 技术文档已交接
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="accountHandover"> 账号密码已交接
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="trainingHandover"> 运维培训已完成
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="issueHandover"> 遗留问题已说明
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="contactHandover"> 联系方式已告知
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">📝 其他信息</div>
                        <div class="form-group">
                            <label>遗留问题说明</label>
                            <textarea id="pendingIssues" rows="2" placeholder="如有未解决的问题，请在此说明"></textarea>
                        </div>
                        <div class="form-group">
                            <label>远程支持方式</label>
                            <input type="text" id="remoteSupportInfo" placeholder="如：企业微信群、手机号等">
                        </div>
                        <div class="form-group">
                            <label>备注</label>
                            <textarea id="departureRemark" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('departureModal')">取消</button>
                <button class="btn btn-pink" onclick="saveDeparture()">提交离场申请</button>
            </div>
        </div>
    </div>

    <!-- 成员管理模态框 -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加项目成员</h3>
                <button class="modal-close" onclick="closeModal('memberModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>姓名 *</label>
                            <input type="text" id="memberName" required>
                        </div>
                        <div class="form-group">
                            <label>角色</label>
                            <select id="memberRole">
                                <option value="项目经理">项目经理</option>
                                <option value="实施工程师" selected>实施工程师</option>
                                <option value="开发工程师">开发工程师</option>
                                <option value="测试工程师">测试工程师</option>
                                <option value="运维工程师">运维工程师</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>手机</label>
                            <input type="text" id="memberPhone">
                        </div>
                        <div class="form-group">
                            <label>邮箱</label>
                            <input type="email" id="memberEmail">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>入场日期</label>
                            <input type="date" id="memberJoinDate">
                        </div>
                        <div class="form-group">
                            <label>当前城市</label>
                            <input type="text" id="memberCity" placeholder="如: 上海, 杭州">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>是否驻场</label>
                        <select id="memberOnsite">
                            <option value="1">是</option>
                            <option value="0">否</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('memberModal')">取消</button>
                <button class="btn btn-primary" onclick="saveMember()">保存</button>
            </div>
        </div>
    </div>

    <!-- 甲方联系人模态框 -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加甲方联系人</h3>
                <button class="modal-close" onclick="closeModal('contactModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>姓名 *</label>
                            <input type="text" id="contactName" required>
                        </div>
                        <div class="form-group">
                            <label>科室</label>
                            <select id="contactDepartment">
                                <option value="信息科">信息科</option>
                                <option value="ICU">ICU</option>
                                <option value="手术室">手术室</option>
                                <option value="麻醉科">麻醉科</option>
                                <option value="设备科">设备科</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>职位</label>
                            <input type="text" id="contactPosition" placeholder="如：科主任、工程师">
                        </div>
                        <div class="form-group">
                            <label>主要联系人</label>
                            <select id="contactPrimary">
                                <option value="0">否</option>
                                <option value="1">是</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>手机</label>
                            <input type="text" id="contactPhoneInput">
                        </div>
                        <div class="form-group">
                            <label>邮箱</label>
                            <input type="email" id="contactEmail">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('contactModal')">取消</button>
                <button class="btn btn-primary" onclick="saveContact()">保存</button>
            </div>
        </div>
    </div>

    <!-- 工作日志模态框 -->
    <div class="modal" id="worklogModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📝 填写工作日志</h3>
                <button class="modal-close" onclick="closeModal('worklogModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="worklogForm">
                    <div class="form-row-3">
                        <div class="form-group">
                            <label>日期 *</label>
                            <input type="date" id="logDate" required>
                        </div>
                        <div class="form-group">
                            <label>工时(小时)</label>
                            <input type="number" id="workHours" value="8" min="0" max="24" step="0.5">
                        </div>
                        <div class="form-group">
                            <label>工作类型</label>
                            <select id="workType">
                                <option value="现场">现场</option>
                                <option value="远程">远程</option>
                                <option value="出差">出差</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>填写人</label>
                        <input type="text" id="logMemberName" placeholder="姓名">
                    </div>
                    <div class="form-group">
                        <label>今日工作内容 *</label>
                        <textarea id="workContent" rows="4" required placeholder="请详细描述今天完成的工作内容"></textarea>
                    </div>
                    <div class="form-group">
                        <label>遇到的问题</label>
                        <textarea id="issuesEncountered" rows="2" placeholder="如有问题请描述"></textarea>
                    </div>
                    <div class="form-group">
                        <label>明日计划</label>
                        <textarea id="tomorrowPlan" rows="2" placeholder="明天计划做的事情"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('worklogModal')">取消</button>
                <button class="btn btn-primary" onclick="saveWorklog()">保存日志</button>
            </div>
        </div>
    </div>

    <!-- AI 智能填报模态框 -->
    <div class="modal" id="aiWorklogModal">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white;">
                <h3>✨ AI 智能填报</h3>
                <button class="modal-close" onclick="closeModal('aiWorklogModal')"
                    style="color:white;background:rgba(255,255,255,0.2);">&times;</button>
            </div>
            <div class="modal-body">
                <div
                    style="margin-bottom: 16px; padding: 12px; background: #eff6ff; border-radius: 8px; font-size: 13px; color: #1e40af;">
                    <strong>💡 提示：</strong> 您可以输入任何自然的语言，例如：
                    <br>"今天在现场配合厂家调试监护仪接口，花了4个小时，遇到协议不兼容的问题，明天打算继续联系厂家修改配置。"
                    <br>AI 将自动提取工时、内容、问题和计划。
                </div>
                <div class="form-group">
                    <label>请输入工作情况描述</label>
                    <textarea id="aiWorklogInput" rows="6" placeholder="例如：上午在医院部署了3台工作站，测试了登录功能，发现有些卡顿..."
                        style="font-size: 14px;"></textarea>
                </div>
                <div id="aiWorklogError" style="color: #ef4444; font-size: 13px; margin-bottom: 12px; display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('aiWorklogModal')">取消</button>
                <button class="btn btn-ai" id="btnAiParse" onclick="parseAiWorklog()">🚀 智能识别并填报</button>
            </div>
        </div>
    </div>

    <!-- AI 智能催单模态框 -->
    <div class="modal" id="aiChaserModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
                <h3>🔔 AI 智能催单</h3>
                <button class="modal-close" onclick="closeModal('aiChaserModal')"
                    style="color:white;background:rgba(255,255,255,0.2);">&times;</button>
            </div>
            <div class="modal-body" style="display: flex; gap: 20px; min-height: 400px;">
                <!-- 左侧：滞后项列表 -->
                <div style="flex: 1; border-right: 1px solid #e5e7eb; padding-right: 20px;">
                    <h4 style="margin-top: 0; margin-bottom: 12px; font-size: 15px; color: #4b5563;">待处理滞后项</h4>
                    <div id="staleItemsList" style="height: 350px; overflow-y: auto;">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- 右侧：生成结果 -->
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <h4 style="margin-top: 0; margin-bottom: 12px; font-size: 15px; color: #4b5563;">AI 生成建议</h4>
                    <div id="chaserResult"
                        style="flex: 1; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 15px; margin-bottom: 15px; overflow-y: auto; font-size: 14px;">
                        <div style="color: #9ca3af; text-align: center; margin-top: 100px;">请从左侧选择一个事项进行生成</div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" style="flex: 1;" onclick="copyChaserContent()">📋 复制内容</button>
                        <button class="btn btn-primary" style="flex: 1;" onclick="sendMockChaser()">📤 模拟发送</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- AI 问答模态框 (NLQ) - Premium Redesign v2 -->
    <div class="modal" id="askAiModal" style="backdrop-filter: blur(12px); background: rgba(2, 6, 23, 0.6);">
        <div class="modal-content"
            style="max-width: 900px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.08); overflow: hidden; box-shadow: 0 40px 80px -15px rgba(0, 0, 0, 0.7); background: #ffffff;">
            <div class="modal-header"
                style="background: #0f172a; color: white; border-bottom: none; padding: 28px 36px; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div
                        style="background: linear-gradient(135deg, #6366f1, #a855f7); width: 44px; height: 44px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 8px 16px -4px rgba(99, 102, 241, 0.4);">
                        🔮</div>
                    <div>
                        <h3 style="margin: 0; font-size: 1.4rem; font-weight: 700; letter-spacing: -0.02em;">AI 项目智能助手
                        </h3>
                        <p style="margin: 4px 0 0 0; font-size: 12px; color: #94a3b8; font-weight: 400;">使用自然语言探索您的项目数据
                        </p>
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal('askAiModal')"
                    style="color: #94a3b8; background: rgba(255,255,255,0.05); width: 36px; height: 36px; border-radius: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; border: none; font-size: 20px;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 36px;">
                <div style="margin-bottom: 32px; position: relative;">
                    <div style="background: #f8fafc; border-radius: 20px; padding: 6px; border: 1px solid #e2e8f0; display: flex; align-items: center; transition: all 0.3s; box-shadow: 0 4px 12px -2px rgba(0,0,0,0.05);"
                        id="aiInputContainer">
                        <div style="padding: 0 16px; color: #6366f1; font-size: 18px;">✨</div>
                        <input type="text" id="aiQuestionInput" placeholder="如：‘找出最近 7 天内所有高优先级的风险事项’"
                            style="flex: 1; height: 60px; font-size: 17px; border: none; background: transparent; padding-right: 20px; color: #1e293b; outline: none; font-weight: 500;">
                        <button class="btn" onclick="submitAiQuestion()"
                            style="height: 52px; border-radius: 16px; background: #0f172a; color: white; border: none; padding: 0 28px; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: all 0.3s; box-shadow: 0 10px 15px -3px rgba(15, 23, 42, 0.2);">
                            <span>分析并执行</span>
                            <span style="font-size: 14px;">⚡</span>
                        </button>
                    </div>
                    <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="font-size: 11px; color: #94a3b8; margin-right: 4px;">热门检索：</span>
                        <span class="badge"
                            style="cursor:pointer; background:#f1f5f9; color:#64748b; border:none; padding:4px 12px; font-weight:500;"
                            onclick="setAiQuestion('显示当前所有正在进行的项目进展')">项目进展</span>
                        <span class="badge"
                            style="cursor:pointer; background:#f1f5f9; color:#64748b; border:none; padding:4px 12px; font-weight:500;"
                            onclick="setAiQuestion('列出风险分高于 80 的所有事项')">高风险监控</span>
                        <span class="badge"
                            style="cursor:pointer; background:#f1f5f9; color:#64748b; border:none; padding:4px 12px; font-weight:500;"
                            onclick="setAiQuestion('分析下个月即将到期的交付节点')">到期提醒</span>
                    </div>
                </div>

                <div id="aiQueryResult" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; border-bottom: 2px solid #f1f5f9; padding-bottom: 12px;">
                        <div>
                            <span id="aiResultCount" style="color: #0f172a; font-size: 15px; font-weight: 700;"></span>
                            <span style="color: #94a3b8; font-size: 13px; margin-left: 8px;">查询已完成</span>
                        </div>
                        <button class="btn btn-xs btn-outline" onclick="toggleAiSql()" id="btnToggleSql"
                            style="font-size: 12px; border-radius: 10px; border-color: #e2e8f0; color: #64748b; display: flex; align-items: center; gap: 6px;">
                            <span>查看逻辑</span>
                            <i
                                style="border: solid #64748b; border-width: 0 2px 2px 0; display: inline-block; padding: 2px; transform: rotate(45deg); transition: 0.3s;"></i>
                        </button>
                    </div>

                    <div id="aiSqlContainer"
                        style="display: none; background: #0f172a; border-radius: 16px; padding: 24px; margin-bottom: 24px; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 13px; color: #94a3b8; line-height: 1.6; position: relative;">
                        <div
                            style="position: absolute; top: 12px; right: 20px; color: #475569; font-size: 11px; font-weight: 600;">
                            GENERATED PROJECT SQL</div>
                        <span id="aiQuerySql" style="color: #cbd5e1; white-space: pre-wrap;"></span>
                    </div>

                    <div class="table-container"
                        style="max-height: 480px; overflow: auto; border-radius: 20px; border: 1px solid #f1f5f9; background: #ffffff; box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.02);">
                        <style>
                            .ai-table {
                                width: 100%;
                                border-collapse: separate;
                                border-spacing: 0;
                            }

                            .ai-table thead th {
                                position: sticky;
                                top: 0;
                                z-index: 10;
                                background: #f8fafc;
                                color: #475569;
                                font-weight: 700;
                                font-size: 13px;
                                padding: 16px;
                                border-bottom: 1px solid #e2e8f0;
                                text-align: left;
                            }

                            .ai-table tbody td {
                                padding: 16px;
                                font-size: 14px;
                                color: #334155;
                                border-bottom: 1px solid #f1f5f9;
                                vertical-align: middle;
                            }

                            .ai-table tbody tr:last-child td {
                                border-bottom: none;
                            }

                            .ai-table tbody tr:hover {
                                background: #f8fafc;
                            }
                        </style>
                        <table class="ai-table" id="aiResultTable">
                            <!-- Injected by JS -->
                        </table>
                    </div>
                </div>

                <div id="aiQueryLoading" style="display: none; text-align: center; padding: 80px 0;">
                    <div style="display: inline-block; position: relative;">
                        <div class="spinner"
                            style="width: 64px; height: 64px; border-width: 5px; border-top-color: #6366f1; border-right-color: transparent; animation: spin 1s linear infinite;">
                        </div>
                        <div
                            style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px;">
                            🧠</div>
                    </div>
                    <div
                        style="color: #0f172a; margin-top: 28px; font-weight: 700; font-size: 18px; letter-spacing: -0.01em;">
                        AI 正在洞察数据库...</div>
                    <div
                        style="color: #64748b; margin-top: 10px; font-size: 14px; max-width: 300px; margin-left: auto; margin-right: auto;">
                        我们正在分析您的提问并将其转化为精准的结构化查询命令</div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- PMO 决策舱 (Portfolio Board) - Premium Redesign -->
    <div class="modal" id="pmoModal" style="backdrop-filter: blur(12px); background: rgba(2, 6, 23, 0.6);">
        <div class="modal-content"
            style="max-width: 1100px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.08); overflow: hidden; box-shadow: 0 40px 80px -15px rgba(0, 0, 0, 0.7); background: #ffffff;">
            <div class="modal-header"
                style="background: #0f172a; color: white; border-bottom: none; padding: 28px 36px; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div
                        style="background: linear-gradient(135deg, #3b82f6, #06b6d4); width: 44px; height: 44px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 8px 16px -4px rgba(59, 130, 246, 0.4);">
                        📊</div>
                    <div>
                        <h3 style="margin: 0; font-size: 1.4rem; font-weight: 700; letter-spacing: -0.02em;">PMO 交付决策舱
                        </h3>
                        <p style="margin: 4px 0 0 0; font-size: 12px; color: #94a3b8; font-weight: 400;">全量项目组合监控与资源效能分析
                        </p>
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal('pmoModal')"
                    style="color: #94a3b8; background: rgba(255,255,255,0.05); width: 36px; height: 36px; border-radius: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; border: none; font-size: 20px;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 30px; background: #f8fafc; overflow-y: auto; max-height: 80vh;">
                <!-- AI Summary Panel -->
                <div class="panel"
                    style="margin-bottom: 24px; border: none; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border-radius: 20px;">
                    <div class="panel-header"
                        style="background: white; border-bottom: 1px solid #f1f5f9; padding: 16px 24px;">
                        <div class="panel-title" style="font-size: 15px; font-weight: 700;">✨ AI 组合治理摘要 (Executive
                            One-pager)</div>
                        <button class="btn btn-xs btn-outline" onclick="loadPmoSummary()" style="font-size: 11px;">🔄
                            重新生成</button>
                    </div>
                    <div class="panel-body" id="pmoAiSummary" style="background: white; min-height: 100px;">
                        <div class="loading-spinner"></div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                    <!-- Distribution Heatmap -->
                    <div class="panel"
                        style="border: none; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border-radius: 20px; background: white;">
                        <div class="panel-header"
                            style="background: white; border-bottom: 1px solid #f1f5f9; padding: 16px 24px;">
                            <div class="panel-title" style="font-size: 15px; font-weight: 700;">🗺️ 区域交付强度分布 (Regional
                                Workload)</div>
                        </div>
                        <div class="panel-body">
                            <div id="pmoRegionalChart" style="height: 400px;"></div>
                        </div>
                    </div>

                    <!-- PM Load Rank -->
                    <div class="panel"
                        style="border: none; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border-radius: 20px; background: white;">
                        <div class="panel-header"
                            style="background: white; border-bottom: 1px solid #f1f5f9; padding: 16px 24px;">
                            <div class="panel-title" style="font-size: 15px; font-weight: 700;">👥 PM 负荷排行</div>
                        </div>
                        <div class="panel-body" id="pmoPmWorkload"
                            style="max-height: 400px; overflow-y: auto; padding: 0;">
                            <!-- List injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 费用模态框 -->
    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💰 录入费用</h3>
                <button class="modal-close" onclick="closeModal('expenseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>费用类型 *</label>
                            <select id="expenseType" required>
                                <option value="差旅">差旅</option>
                                <option value="住宿">住宿</option>
                                <option value="餐饮">餐饮</option>
                                <option value="交通">交通</option>
                                <option value="采购">采购</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>金额(元) *</label>
                            <input type="number" id="expenseAmount" required step="0.01" min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>日期 *</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group">
                            <label>申请人</label>
                            <input type="text" id="expenseApplicant">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>说明</label>
                        <textarea id="expenseDesc" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('expenseModal')">取消</button>
                <button class="btn btn-primary" onclick="saveExpense()">保存</button>
            </div>
        </div>
    </div>

    <!-- 变更申请模态框 -->
    <div class="modal" id="changeModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📝 变更申请</h3>
                <button class="modal-close" onclick="closeModal('changeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="changeForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>变更类型 *</label>
                            <select id="changeType" required>
                                <option value="需求变更">需求变更</option>
                                <option value="范围变更">范围变更</option>
                                <option value="时间变更">时间变更</option>
                                <option value="人员变更">人员变更</option>
                                <option value="费用变更">费用变更</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>申请人</label>
                            <input type="text" id="changeRequestedBy">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>变更标题 *</label>
                        <input type="text" id="changeTitle" required placeholder="简要描述变更内容">
                    </div>
                    <div class="form-group">
                        <label>变更详情</label>
                        <textarea id="changeDesc" rows="4" placeholder="详细描述变更内容"></textarea>
                    </div>
                    <div class="form-group">
                        <label>影响分析</label>
                        <textarea id="changeImpact" rows="3" placeholder="对项目进度、成本、范围的影响"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('changeModal')">取消</button>
                <button class="btn btn-primary" onclick="saveChange()">提交变更</button>
            </div>
        </div>
    </div>

    <!-- 验收模态框 -->
    <div class="modal" id="acceptanceModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>✅ 验收申请</h3>
                <button class="modal-close" onclick="closeModal('acceptanceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="acceptanceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>验收类型 *</label>
                            <select id="acceptanceType" required>
                                <option value="阶段验收">阶段验收</option>
                                <option value="最终验收">最终验收</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>验收日期</label>
                            <input type="date" id="acceptanceDate">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>关联阶段</label>
                            <select id="acceptanceStageName">
                                <option value="">-- 请选择 --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>通过率(%)</label>
                            <input type="number" id="acceptancePassRate" min="0" max="100" placeholder="如: 95">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>甲方签字人</label>
                            <input type="text" id="acceptanceCustomerSign">
                        </div>
                        <div class="form-group">
                            <label>我方签字人</label>
                            <input type="text" id="acceptanceOurSign">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>发现的问题</label>
                        <textarea id="acceptanceIssues" rows="3" placeholder="验收过程中发现的问题"></textarea>
                    </div>
                    <div class="form-group">
                        <label>备注</label>
                        <textarea id="acceptanceRemark" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('acceptanceModal')">取消</button>
                <button class="btn btn-primary" onclick="saveAcceptance()">提交验收</button>
            </div>
        </div>
    </div>

    <!-- 满意度调查模态框 -->
    <div class="modal" id="satisfactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⭐ 满意度调查</h3>
                <button class="modal-close" onclick="closeModal('satisfactionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="satisfactionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>调查类型</label>
                            <select id="surveyType">
                                <option value="定期回访">定期回访</option>
                                <option value="阶段评价">阶段评价</option>
                                <option value="最终评价">最终评价</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>调查人</label>
                            <input type="text" id="surveyor">
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">评分项（1-5分）</div>
                        <div class="form-group">
                            <label>系统质量</label>
                            <div class="star-rating" id="ratingQuality" data-score="0"></div>
                        </div>
                        <div class="form-group">
                            <label>服务态度</label>
                            <div class="star-rating" id="ratingService" data-score="0"></div>
                        </div>
                        <div class="form-group">
                            <label>响应速度</label>
                            <div class="star-rating" id="ratingResponse" data-score="0"></div>
                        </div>
                        <div class="form-group">
                            <label>专业能力</label>
                            <div class="star-rating" id="ratingProfessional" data-score="0"></div>
                        </div>
                        <div class="form-group">
                            <label>总体满意度</label>
                            <div class="star-rating" id="ratingOverall" data-score="0"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>文字反馈</label>
                        <textarea id="satisfactionFeedback" rows="3" placeholder="客户的意见和建议"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('satisfactionModal')">取消</button>
                <button class="btn btn-primary" onclick="saveSatisfaction()">保存</button>
            </div>
        </div>
    </div>

    <!-- 如果有关闭按钮，确保它能工作 -->
    <div id="projectAccessModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>👥 项目成员授权</h3>
                <button class="btn-close" onclick="closeModal('projectAccessModal')">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>添加成员</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="accessUserSelect" class="form-control" style="flex: 2;">
                            <option value="">加载中...</option>
                        </select>
                        <select id="accessRoleSelect" class="form-control" style="flex: 1;">
                            <option value="member">成员</option>
                            <option value="manager">经理</option>
                            <option value="viewer">访客</option>
                        </select>
                        <button class="btn btn-primary" onclick="addProjectAccess()">添加</button>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="form-group">
                    <label>已授权成员</label>
                    <div id="projectMemberList" style="max-height: 300px; overflow-y: auto;">
                        <!-- 成员列表 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('projectAccessModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 全局用户管理模态框 -->
    <div id="userManagementModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>👥 全局用户管理 (管理员)</h3>
                <button class="btn-close" onclick="closeModal('userManagementModal')">×</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-size: 13px; color: var(--gray-500);">
                        仅管理员可见。可禁用违规账号或重置密码。
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="loadGlobalUsers()">
                        <span class="icon">🔄</span> 刷新列表
                    </button>
                </div>

                <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                    <table class="table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>用户名</th>
                                <th>显示名</th>
                                <th>角色</th>
                                <th>状态</th>
                                <th>最后登录</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="globalUserList">
                            <!-- 用户列表 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userManagementModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 密码重置确认模态框 -->
    <div id="passwordResetModal" class="modal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>🔐 重置密码</h3>
                <button class="btn-close" onclick="closeModal('passwordResetModal')">×</button>
            </div>
            <div class="modal-body">
                <p>正在为用户 <strong id="resetTargetUser"></strong> 重置密码。</p>
                <div class="form-group">
                    <label>新密码</label>
                    <input type="text" id="newPasswordInput" class="form-control" placeholder="输入新密码" value="123456">
                    <div class="hint">建议使用强密码。默认: 123456</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('passwordResetModal')">取消</button>
                <button class="btn btn-danger" onclick="confirmResetPassword()">确认重置</button>
            </div>
        </div>
    </div>

    <!-- 回访记录模态框 -->
    <div class="modal" id="followupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📞 回访记录</h3>
                <button class="modal-close" onclick="closeModal('followupModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="followupForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>回访日期</label>
                            <input type="date" id="followupDate">
                        </div>
                        <div class="form-group">
                            <label>回访方式</label>
                            <select id="followupType">
                                <option value="电话回访">电话回访</option>
                                <option value="现场回访">现场回访</option>
                                <option value="远程回访">远程回访</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>联系人</label>
                            <input type="text" id="followupContactPerson">
                        </div>
                        <div class="form-group">
                            <label>回访人</label>
                            <input type="text" id="followupBy">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>回访内容</label>
                        <textarea id="followupContent" rows="4" placeholder="回访详情"></textarea>
                    </div>
                    <div class="form-group">
                        <label>发现的问题</label>
                        <textarea id="followupIssues" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>下次回访日期</label>
                        <input type="date" id="nextFollowupDate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('followupModal')">取消</button>
                <button class="btn btn-primary" onclick="saveFollowup()">保存记录</button>
            </div>
        </div>
    </div>

    <!-- 费用统计模态框 -->
    <div class="modal" id="expenseStatsModal">
        <div class="modal-content modal-large" style="max-width: 900px;">
            <div class="modal-header">
                <h3>💰 项目费用分析</h3>
                <button class="modal-close" onclick="closeModal('expenseStatsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="overview-grid" style="margin-bottom: 20px;">
                    <div class="overview-card">
                        <div class="overview-card-title">总支出</div>
                        <div class="overview-card-value" id="statsTotalExpense">¥0.00</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-card-title">待报销</div>
                        <div class="overview-card-value" id="statsPendingExpense" style="color:var(--warning);">¥0.00
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="panel" style="flex: 1; min-width: 300px;">
                        <div class="panel-header">
                            <div class="panel-title">费用构成 (按类型)</div>
                        </div>
                        <div class="panel-body">
                            <div id="expenseTypeChart" style="width: 100%; height: 300px;"></div>
                        </div>
                    </div>
                    <div class="panel" style="flex: 1; min-width: 300px;">
                        <div class="panel-header">
                            <div class="panel-title">支出趋势 (按月)</div>
                        </div>
                        <div class="panel-body">
                            <div id="expenseTrendChart" style="width: 100%; height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 工时统计模态框 -->
    <div class="modal" id="worklogStatsModal">
        <div class="modal-content modal-large" style="max-width: 900px;">
            <div class="modal-header">
                <h3>📊 工时投入分析</h3>
                <button class="modal-close" onclick="closeModal('worklogStatsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="overview-grid" style="margin-bottom: 20px;">
                    <div class="overview-card">
                        <div class="overview-card-title">投入总工时</div>
                        <div class="overview-card-value" id="statsTotalHours">0h</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-card-title">人均工时</div>
                        <div class="overview-card-value" id="statsAvgHours">0h</div>
                    </div>
                </div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="panel" style="flex: 1; min-width: 300px;">
                        <div class="panel-header">
                            <div class="panel-title">成员投入分布</div>
                        </div>
                        <div class="panel-body">
                            <div id="worklogMemberChart" style="width: 100%; height: 300px;"></div>
                        </div>
                    </div>
                    <div class="panel" style="flex: 1; min-width: 300px;">
                        <div class="panel-header">
                            <div class="panel-title">每月投入趋势</div>
                        </div>
                        <div class="panel-body">
                            <div id="worklogTrendChart" style="width: 100%; height: 300px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 接口模态框 -->
    <div class="modal" id="interfaceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新增接口</h3>
                <button class="modal-close" onclick="closeModal('interfaceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="interfaceForm">
                    <div class="form-group"
                        style="background:#f0f7ff; padding:12px; border-radius:8px; margin-bottom:15px; border:1px solid #d0e7ff;">
                        <label style="color:#0056b3; font-weight:700;">📚 标准库导入 (可选)</label>
                        <select id="interfaceTemplateSelect" onchange="applyInterfaceTemplate(this.value)"
                            style="border-color:#0056b3;">
                            <option value="">-- 请选择预设模版 --</option>
                            <option value="his_patient">HIS: 患者基本信息 (ADT)</option>
                            <option value="his_order">HIS: 医嘱同步 (ORM)</option>
                            <option value="lis_report">LIS: 检验报告 (ORU)</option>
                            <option value="pacs_link">PACS: 影像调阅</option>
                            <option value="emr_sync">EMR: 病历同步</option>
                            <option value="排班">手术排班: 排班数据采集</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>系统名称</label>
                        <select id="systemName">
                            <option value="HIS">HIS (医院信息系统)</option>
                            <option value="LIS">LIS (检验系统)</option>
                            <option value="PACS">PACS (影像系统)</option>
                            <option value="EMR">EMR (电子病历)</option>
                            <option value="手术排班">手术排班系统</option>
                            <option value="护理系统">护理系统</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>接口名称</label>
                        <input type="text" id="interfaceName" placeholder="如：患者基本信息查询">
                    </div>
                    <div class="form-group">
                        <label>状态</label>
                        <select id="interfaceStatus">
                            <option value="待开发">待开发</option>
                            <option value="开发中">开发中</option>
                            <option value="联调中">联调中</option>
                            <option value="已完成">已完成</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>备注</label>
                        <textarea id="interfaceRemark" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('interfaceModal')">取消</button>
                <button class="btn btn-primary" onclick="saveInterface()">保存</button>
            </div>
        </div>
    </div>

    <!-- 任务依赖模态框 -->
    <div class="modal" id="dependencyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔗 添加任务依赖</h3>
                <button class="modal-close" onclick="closeModal('dependencyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>本任务</label>
                    <select id="depTaskId" class="form-control"></select>
                </div>
                <div class="form-group">
                    <label>依赖于 (前置任务)</label>
                    <select id="depDependsOnId" class="form-control"></select>
                </div>
                <div class="form-group" style="margin-top:15px;">
                    <label>依赖类型</label>
                    <select id="depType" class="form-control">
                        <option value="finish_to_start">完成-开始 (FS)</option>
                        <option value="start_to_start">开始-开始 (SS)</option>
                        <option value="finish_to_finish">完成-完成 (FF)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('dependencyModal')">取消</button>
                <button class="btn btn-primary" onclick="saveDependency()">保存依赖</button>
            </div>
        </div>
    </div>

    <!-- 问题模态框 -->
    <div class="modal" id="issueModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新增问题</h3>
                <button class="modal-close" onclick="closeModal('issueModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="issueForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>问题类型</label>
                            <select id="issueType">
                                <option value="技术">技术问题</option>
                                <option value="需求">需求变更</option>
                                <option value="协调">协调沟通</option>
                                <option value="资源">资源不足</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>严重程度</label>
                            <select id="issueSeverity">
                                <option value="高">高 - 阻塞进度</option>
                                <option value="中">中 - 影响效率</option>
                                <option value="低">低 - 小问题</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>问题描述 *</label>
                        <textarea id="issueDesc" rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('issueModal')">取消</button>
                <button class="btn btn-primary" onclick="saveIssue()">保存</button>
            </div>
        </div>
    </div>

    <!-- 设备模态框 -->
    <div class="modal" id="deviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>录入医疗设备</h3>
                <button class="modal-close" onclick="closeModal('deviceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="deviceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>设备类型</label>
                            <select id="deviceType">
                                <option value="监护仪">监护仪</option>
                                <option value="呼吸机">呼吸机</option>
                                <option value="麻醉机">麻醉机</option>
                                <option value="输注泵">输注泵</option>
                                <option value="血气分析仪">血气分析仪</option>
                                <option value="除颤仪">除颤仪</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>品牌型号</label>
                            <input type="text" id="deviceModel" placeholder="如：飞利浦 MX800">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>通信协议</label>
                            <select id="deviceProtocol">
                                <option value="网络(TCP/IP)">网络(TCP/IP)</option>
                                <option value="串口(RS232)">串口(RS232)</option>
                                <option value="HL7">HL7</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>IP地址</label>
                            <input type="text" id="deviceIp" placeholder="192.168.x.x">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>状态</label>
                        <select id="deviceStatus">
                            <option value="未连接">未连接</option>
                            <option value="已物理连接">已物理连接</option>
                            <option value="解析中">解析中</option>
                            <option value="已入库">已入库</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('deviceModal')">取消</button>
                <button class="btn btn-primary" onclick="saveDevice()">保存</button>
            </div>
        </div>
    </div>

    <!-- 里程碑模态框 -->
    <div class="modal" id="milestoneModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加里程碑</h3>
                <button class="modal-close" onclick="closeModal('milestoneModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="milestoneForm">
                    <div class="form-group">
                        <label>里程碑名称 *</label>
                        <input type="text" id="milestoneName" required>
                    </div>
                    <div class="form-group">
                        <label>目标日期 *</label>
                        <input type="date" id="milestoneDate" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('milestoneModal')">取消</button>
                <button class="btn btn-primary" onclick="saveMilestone()">保存</button>
            </div>
        </div>
    </div>

    <!-- 文档上传模态框 -->
    <div class="modal" id="documentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📄 上传文档</h3>
                <button class="modal-close" onclick="closeModal('documentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="documentForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label>选择文件</label>
                        <input type="file" id="docFile"
                            accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar,.png,.jpg,.jpeg">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>文档名称</label>
                            <input type="text" id="docName" placeholder="如不填则使用文件名">
                        </div>
                        <div class="form-group">
                            <label>版本号</label>
                            <input type="text" id="docVersion" value="v1.0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>文档类型</label>
                            <select id="docType">
                                <option value="需求文档">需求文档</option>
                                <option value="设计文档">设计文档</option>
                                <option value="部署文档">部署文档</option>
                                <option value="接口文档">接口文档</option>
                                <option value="培训材料">培训材料</option>
                                <option value="验收报告">验收报告</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>文档分类</label>
                            <select id="docCategory">
                                <option value="内部文档">内部文档</option>
                                <option value="交付文档">交付文档</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>上传人</label>
                        <input type="text" id="docUploadBy">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('documentModal')">取消</button>
                <button class="btn btn-primary" onclick="saveDocument()">上传</button>
            </div>
        </div>
    </div>

    <!-- AI 风险评估模态框 -->
    <div class="modal" id="riskModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ef4444, #f97316); color: white;">
                <h3 style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:24px;">🚩</span> AI 风险评估报告
                </h3>
                <button class="modal-close" onclick="closeModal('riskModal')"
                    style="background:rgba(255,255,255,0.2);color:white;">&times;</button>
            </div>
            <div class="modal-body" style="padding:0;background:#f9fafb;">
                <div id="riskLoading" class="loading-spinner" style="padding:60px;">
                    <div class="spinner"></div>
                    <p>AI 正在分析项目风险...</p>
                </div>
                <div id="riskContent" style="display:none;padding:24px;">
                    <div id="riskScoreDisplay" style="text-align:center; margin-bottom:20px;">
                        <div style="font-size:14px; color:#6b7280; margin-bottom:8px;">风险评分</div>
                        <div id="riskScoreValue" style="font-size:64px; font-weight:800; line-height:1;"></div>
                        <div id="riskScoreLabel" style="font-size:14px; margin-top:8px; font-weight:600;"></div>
                    </div>
                    <div style="background:white; border-radius:12px; padding:16px; border:1px solid #e5e7eb;">
                        <div style="font-size:13px; color:#6b7280; margin-bottom:8px; font-weight:600;">📋 风险分析</div>
                        <div id="riskAnalysisText" style="font-size:14px; color:#374151; line-height:1.6;"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="refreshRiskAnalysis()">🔄 重新评估</button>
                <button class="btn btn-primary" onclick="callAiAnalysis(currentProjectId)">🤖 完整诊断</button>
                <button class="btn btn-outline" onclick="closeModal('riskModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- AI 分析模态框 -->
    <div class="modal" id="aiModal">
        <div class="modal-content modal-large">
            <div class="modal-header" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white;">
                <h3 style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:24px;">🤖</span> AI 智能诊断报告
                </h3>
                <button class="modal-close" onclick="closeModal('aiModal')"
                    style="background:rgba(255,255,255,0.2);color:white;">&times;</button>
            </div>
            <div class="modal-body" style="padding:0;background:#f9fafb;">
                <div id="aiLoading" class="loading-spinner" style="padding:60px;">
                    <div class="spinner"></div>
                    <p>AI 正在深度分析项目数据...</p>
                </div>
                <div id="aiContent" style="display:none;padding:24px;"></div>
                <div id="aiRadarContainer" style="display:none; padding: 0 24px 24px 24px;">
                    <div id="aiRadarChart"
                        style="width: 100%; height: 350px; background: white; border-radius: 12px; border: 1px solid var(--gray-200);">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="refreshAiAnalysis()">🔄 重新生成</button>
                <button class="btn btn-primary" onclick="generateWeeklyReport(currentProjectId)">📋 周报</button>
                <button class="btn btn-success" onclick="exportProjectReport(currentProjectId)">📤 导出Json</button>
                <button class="btn btn-info" onclick="exportProjectPDF(currentProjectId)">📄 导出PDF</button>
                <button class="btn btn-outline" onclick="showBurndownChart(currentProjectId)">📈 燃尽图</button>
                <button class="btn btn-outline" onclick="copyReportContent('aiContent')">📋 复制</button>
                <button class="btn btn-outline" onclick="closeModal('aiModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 智能预警中心模态框 -->
    <div class="modal" id="warningModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #ef4444, #f97316); color: white;">
                <h3 style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:24px;">⚠️</span> 智能预警中心
                </h3>
                <button class="modal-close" onclick="closeModal('warningModal')"
                    style="background:rgba(255,255,255,0.2);color:white;">&times;</button>
            </div>
            <div class="modal-body" style="padding:20px;background:#f9fafb;max-height:500px;overflow-y:auto;">
                <div id="warningList">
                    <div style="text-align:center;padding:40px;color:var(--gray-500);">加载中...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="loadWarnings()">🔄 刷新</button>
                <button class="btn btn-outline" onclick="closeModal('warningModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 收入录入模态框 -->
    <div class="modal" id="revenueModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
                <h3 style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:24px;">💰</span> 录入项目收入
                </h3>
                <button class="modal-close" onclick="closeModal('revenueModal')"
                    style="color:white;opacity:0.8;background:transparent;border:none;font-size:24px;cursor:pointer;">&times;</button>
            </div>
            <div class="modal-body" style="padding:20px;">
                <form id="revenueForm" onsubmit="submitRevenue(event)">
                    <input type="hidden" id="revenueProjectId">
                    <div class="form-group" style="margin-bottom:15px;">
                        <label style="display:block;margin-bottom:5px;font-size:13px;font-weight:600;">收入金额 (元)</label>
                        <input type="number" id="revenueAmount" step="0.01" required placeholder="0.00"
                            style="width:100%;padding:10px;border:1px solid var(--gray-300);border-radius:6px;">
                    </div>
                    <div class="form-group" style="margin-bottom:15px;">
                        <label style="display:block;margin-bottom:5px;font-size:13px;font-weight:600;">收入日期</label>
                        <input type="date" id="revenueDate" required
                            style="width:100%;padding:10px;border:1px solid var(--gray-300);border-radius:6px;">
                    </div>
                    <div class="form-group" style="margin-bottom:15px;">
                        <label style="display:block;margin-bottom:5px;font-size:13px;font-weight:600;">收入类型</label>
                        <select id="revenueType"
                            style="width:100%;padding:10px;border:1px solid var(--gray-300);border-radius:6px;">
                            <option value="合同款">合同款</option>
                            <option value="阶段款">阶段款</option>
                            <option value="验收款">验收款</option>
                            <option value="维保费">维保费</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom:20px;">
                        <label style="display:block;margin-bottom:5px;font-size:13px;font-weight:600;">备注说明</label>
                        <textarea id="revenueDescription" rows="3" placeholder="摘要、备注等..."
                            style="width:100%;padding:10px;border:1px solid var(--gray-300);border-radius:6px;"></textarea>
                    </div>
                    <div style="display:flex;justify-content:flex-end;gap:10px;">
                        <button type="button" class="btn btn-outline" onclick="closeModal('revenueModal')">取消</button>
                        <button type="submit" class="btn btn-success">确认录入</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 周报模态框 -->
    <div class="modal" id="reportModal">
        <div class="modal-content modal-large">
            <div class="modal-header" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white;">
                <h3 style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:24px;">📋</span> 项目周报
                </h3>
                <button class="modal-close" onclick="closeModal('reportModal')"
                    style="background:rgba(255,255,255,0.2);color:white;">&times;</button>
            </div>
            <div class="modal-body" id="reportContent" style="padding:30px;">
                <div style="text-align:center;padding:40px;color:var(--gray-500);">加载中...</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('reportModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 接口文档上传解析弹窗 -->
    <div class="modal" id="specUploadModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="specUploadTitle">上传接口文档</h3>
                <button class="modal-close" onclick="closeModal('specUploadModal')">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group" id="specCategoryGroup" style="display:none;">
                    <label>文档分类</label>
                    <select id="specCategory">
                        <option value="手麻标准">🏥 手麻标准</option>
                        <option value="重症标准">🧪 重症标准</option>
                        <option value="接口文档">📄 接口文档</option>
                        <option value="其他">📁 其他</option>
                    </select>
                </div>
                <div class="form-group" id="specVendorNameGroup" style="display:none;">
                    <label>对方厂商名称</label>
                    <input type="text" id="specVendorName" placeholder="如：卫宁健康、东软、创业慧康...">
                </div>
                <div class="form-group">
                    <label>选择文件（PDF/Word/TXT）</label>
                    <input type="file" id="specFileInput" accept=".pdf,.doc,.docx,.txt"
                        onchange="InterfaceSpec.handleFileSelect()">
                </div>
                <div class="form-group">
                    <label>文档内容（可直接粘贴）</label>
                    <textarea id="specDocText" rows="12"
                        placeholder="将接口文档内容粘贴到此处，或通过上方文件选择器上传文件自动提取...&#10;&#10;支持格式：PDF、Word、纯文本&#10;AI 将自动识别并结构化提取所有接口定义、字段、类型、必填项等信息。"
                        style="font-family:monospace;font-size:13px;"></textarea>
                </div>
                <div id="specParseResult" style="display:none;margin-top:16px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('specUploadModal')">取消</button>
                <button class="btn btn-ai" id="btnSpecParse" onclick="InterfaceSpec.submitParse()">🤖 开始 AI 解析</button>
            </div>
        </div>
    </div>

    <!-- 字段对照详情弹窗 -->
    <div class="modal" id="fieldDetailModal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3>📋 字段对照详情</h3>
                <button class="modal-close" onclick="closeModal('fieldDetailModal')">×</button>
            </div>
            <div class="modal-body" id="fieldDetailBody">
                <div style="text-align:center;padding:40px;color:var(--gray-500);">加载中...</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('fieldDetailModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 沟通记录模态框 -->
    <div class="modal" id="communicationModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>💬 添加沟通记录</h3>
                <button class="modal-close" onclick="closeModal('communicationModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>日期</label>
                    <input type="date" id="commDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>联系人</label>
                    <input type="text" id="commPerson" class="form-control" placeholder="甲方联系人">
                </div>
                <div class="form-group">
                    <label>方式</label>
                    <select id="commMethod" class="form-control">
                        <option value="电话">📞 电话</option>
                        <option value="微信">💬 微信</option>
                        <option value="现场">🏢 现场</option>
                        <option value="邮件">📧 邮件</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>沟通摘要</label>
                    <textarea id="commSummary" class="form-control" rows="3" placeholder="记录沟通要点..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('communicationModal')">取消</button>
                <button class="btn btn-primary" onclick="saveCommunication()">保存</button>
            </div>
        </div>
    </div>

    <!-- 提醒模态框 -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>🔔 消息提醒</h3>
                <button class="modal-close" onclick="closeModal('notificationsModal')">&times;</button>
            </div>
            <div class="modal-body" id="notificationsList"></div>
            <div class="modal-footer">
                <button class="btn btn-outline btn-sm" onclick="checkReminders()">🔄 检查提醒</button>
                <button class="btn btn-success btn-sm" onclick="markAllNotificationsRead()">✓ 一键已读</button>
                <button class="btn btn-danger btn-sm" onclick="deleteAllNotifications()">🗑 清空</button>
                <button class="btn btn-outline" onclick="closeModal('notificationsModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 全局甘特图模态框 -->
    <div class="modal" id="globalGanttModal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3>📅 项目总览甘特图</h3>
                <button class="modal-close" onclick="closeModal('globalGanttModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="gantt-legend" id="globalGanttLegend"></div>
                <div class="global-gantt-container" id="globalGanttChart"></div>
            </div>
        </div>
    </div>

    <!-- 燃尽图模态框 -->
    <div class="modal" id="burndownModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📈 项目燃尽图</h3>
                <button class="modal-close" onclick="closeModal('burndownModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="burndownChart" class="burndown-chart"></div>
                <div style="margin-top:16px; padding:14px; background:var(--gray-50); border-radius:8px;">
                    <div style="display:flex; gap:20px; flex-wrap:wrap; font-size:13px;">
                        <span><span
                                style="display:inline-block;width:12px;height:12px;background:#3b82f6;margin-right:6px;border-radius:2px;"></span>理想进度</span>
                        <span><span
                                style="display:inline-block;width:12px;height:12px;background:#10b981;margin-right:6px;border-radius:2px;"></span>实际进度</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 状态变更模态框 -->
    <div class="modal" id="statusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔄 变更项目状态</h3>
                <button class="modal-close" onclick="closeModal('statusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom:16px;color:var(--gray-600);">当前状态：<strong id="currentStatusText"></strong></p>
                <p style="margin-bottom:12px;font-size:13px;">可变更为：</p>
                <div id="availableStatusList" class="btn-group" style="flex-direction:column;"></div>
            </div>
        </div>
    </div>

    <!-- 知识库模态框 -->
    <div class="modal" id="kbModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>新增知识库案例</h3>
                <button class="modal-close" onclick="closeModal('kbModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="kbForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>类别</label>
                            <select id="kbCategory">
                                <option value="HIS接口">HIS接口</option>
                                <option value="硬件设备">硬件设备</option>
                                <option value="技术方案">技术方案</option>
                                <option value="避坑指南">避坑指南</option>
                                <option value="交付经验">交付经验</option>
                                <option value="系统配置">系统配置</option>
                                <option value="科室沟通">科室沟通</option>
                                <option value="其它">其它</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>关联阶段 (自动推荐用)</label>
                            <select id="kbAssocStage">
                                <option value="">不限阶段</option>
                                <option value="项目启动">项目启动</option>
                                <option value="需求调研">需求调研</option>
                                <option value="系统部署">系统部署</option>
                                <option value="表单制作">表单制作</option>
                                <option value="接口对接">接口对接</option>
                                <option value="设备对接">设备对接</option>
                                <option value="数据采集">数据采集</option>
                                <option value="系统培训">系统培训</option>
                                <option value="试运行">试运行</option>
                                <option value="验收上线">验收上线</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>标签 (逗号分隔)</label>
                            <input type="text" id="kbTags" placeholder="如：手术室, 接口, 飞利浦">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>标题 *</label>
                        <input type="text" id="kbTitle" required placeholder="输入简洁明了的案例标题">
                    </div>
                    <div class="form-group">
                        <label>详细内容 *</label>
                        <textarea id="kbContent" rows="10" required placeholder="支持 Markdown 格式..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>关联项目 (可选)</label>
                            <select id="kbProject">
                                <option value="">无关联</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>作者</label>
                            <input type="text" id="kbAuthor" placeholder="默认当前用户">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>附件上传 (支持 PDF/Office/图片)</label>
                            <input type="file" id="kbAttachment">
                        </div>
                        <div class="form-group">
                            <label>外部链接 (如网盘地址)</label>
                            <input type="text" id="kbExternalLink" placeholder="https://...">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('kbModal')">取消</button>
                <button class="btn btn-primary" onclick="saveKBItem()">保存案例</button>
            </div>
        </div>
    </div>

    <!-- 知识库详情模态框 -->
    <div class="modal" id="kbDetailModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="kbDetailTitle">案例详情</h3>
                <button class="modal-close" onclick="closeModal('kbDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="kb-detail-meta"
                    style="margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--gray-100);">
                    <span class="badge badge-info" id="kbDetailCategory"></span>
                    <span style="margin-left: 15px; color: var(--gray-500); font-size: 13px;">作者: <span
                            id="kbDetailAuthor"></span></span>
                    <span style="margin-left: 15px; color: var(--gray-500); font-size: 13px;">更新于: <span
                            id="kbDetailDate"></span></span>
                </div>
                <div id="kbDetailContent"
                    style="line-height: 1.6; color: var(--gray-800); min-height: 200px; white-space: pre-wrap;"></div>
                <div id="kbDetailResources"
                    style="margin-top: 15px; padding: 10px; background: var(--gray-50); border-radius: 6px; display: none;">
                    <div style="font-weight: 600; font-size: 13px; color: var(--gray-600); margin-bottom: 8px;">📚 相关资源
                    </div>
                    <div id="kbDetailAttachment" style="font-size: 13px; margin-bottom: 5px;"></div>
                    <div id="kbDetailLink" style="font-size: 13px;"></div>
                </div>
                <div id="kbDetailTags" style="margin-top: 20px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('kbDetailModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 硬件资产管理模态框 -->
    <div class="modal" id="assetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新增硬件资产</h3>
                <button class="modal-close" onclick="closeModal('assetModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="assetForm">
                    <div class="form-group">
                        <label>资产名称 *</label>
                        <input type="text" id="assetName" required placeholder="如：中凯边缘计算网关">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>序列号 (SN)</label>
                            <input type="text" id="assetSn" placeholder="SNxxxxxxxx">
                        </div>
                        <div class="form-group">
                            <label>型号</label>
                            <input type="text" id="assetModel" placeholder="如：ZK-Gateway-V4">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>状态</label>
                            <select id="assetStatus">
                                <option value="在库">在库</option>
                                <option value="借出">借出</option>
                                <option value="现场运行">现场运行</option>
                                <option value="维修中">维修中</option>
                                <option value="已报废">已报废</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>当前存放地</label>
                            <input type="text" id="assetLocation" placeholder="如：成都研发仓库">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>关联项目 (若在现场)</label>
                        <select id="assetProject">
                            <option value="">未关联项目</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>负责人</label>
                        <input type="text" id="assetOperator">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('assetModal')">取消</button>
                <button class="btn btn-primary" onclick="saveAsset()">保存资产</button>
            </div>
        </div>
    </div>

    <!-- AI 日报模态框 -->
    <div id="dailyReportModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📅 项目实施日报 (AI生成)</h3>
                <button class="btn btn-icon" onclick="closeModal('dailyReportModal')">✕</button>
            </div>
            <div class="modal-body">
                <div id="dailyReportContent"
                    style="min-height: 300px; padding: 20px; background: #f9fafb; border-radius: 8px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="copyDailyReport()">📋 复制内容</button>
                <button class="btn btn-outline" onclick="closeModal('dailyReportModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 项目成员管理模态框 -->
    <div id="projectAccessModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>👥 项目参与成员管理</h3>
                <button class="modal-close" onclick="closeModal('projectAccessModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-section-title">➕ 授权新成员</div>
                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                        <div class="form-group" style="flex: 2; margin-bottom: 0;">
                            <label>选择用户</label>
                            <select id="accessUserSelect">
                                <option value="">正在加载用户列表...</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label>访问角色</label>
                            <select id="accessRoleSelect">
                                <option value="member">普通成员 (member)</option>
                                <option value="manager">项目经理 (manager)</option>
                                <option value="owner">所有者 (owner)</option>
                                <option value="viewer">观察者 (viewer)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="addProjectAccess()" style="height: 42px;">添加</button>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">📋 当前成员列表</div>
                    <div id="projectMemberList" style="max-height: 300px; overflow-y: auto;">
                        <!-- JS 渲染列表 -->
                        <div style="text-align: center; color: var(--gray-400); padding: 20px;">正在加载成员...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('projectAccessModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 登录模态框 -->
    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>🔐 用户登录</h3>
                <button class="modal-close" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="loginForm">
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" id="loginUsername" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" id="loginPassword" placeholder="请输入密码">
                    </div>
                    <div id="loginError" style="color: #ef4444; font-size: 13px; margin-bottom: 12px; display: none;">
                    </div>
                    <button class="btn btn-primary btn-full" onclick="doLogin()">登录</button>
                    <div style="text-align: center; margin-top: 16px; font-size: 13px; color: #6b7280;">
                        没有账户？<a href="#" onclick="showRegisterForm()" style="color: #4f46e5;">立即注册</a>
                    </div>
                </div>
                <div id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" id="regUsername" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" id="regPassword" placeholder="请输入密码">
                    </div>
                    <div class="form-group">
                        <label>确认密码</label>
                        <input type="password" id="regPasswordConfirm" placeholder="再次输入密码">
                    </div>
                    <div class="form-group">
                        <label>显示名称</label>
                        <input type="text" id="regDisplayName" placeholder="您的姓名">
                    </div>
                    <div id="regError" style="color: #ef4444; font-size: 13px; margin-bottom: 12px; display: none;">
                    </div>
                    <button class="btn btn-primary btn-full" onclick="doRegister()">注册</button>
                    <div style="text-align: center; margin-top: 16px; font-size: 13px; color: #6b7280;">
                        已有账户？<a href="#" onclick="showLoginForm()" style="color: #4f46e5;">返回登录</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 提醒中心模态框 -->
    <div id="reminderModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>🔔 提醒中心</h3>
                <button class="modal-close" onclick="closeModal('reminderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="reminderDigest" style="margin-bottom: 20px;">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>加载中...</p>
                    </div>
                </div>
                <div class="tabs" id="reminderTabs">
                    <div class="tab active" onclick="switchReminderTab('overdue')">🚨 逾期项</div>
                    <div class="tab" onclick="switchReminderTab('upcoming')">⏰ 即将到期</div>
                    <div class="tab" onclick="switchReminderTab('stale')">💤 待处理问题</div>
                    <div class="tab" onclick="switchReminderTab('idle')">😴 闲置项目</div>
                </div>
                <div id="reminderListContainer" style="max-height: 400px; overflow-y: auto;">
                    <!-- 由 JS 渲染 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('reminderModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 项目对比模态框 -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3>📊 项目对比分析</h3>
                <button class="modal-close" onclick="closeModal('comparisonModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">选择要对比的项目 (最多选择5个)</label>
                    <div id="comparisonProjectList"
                        style="display: flex; flex-wrap: wrap; gap: 8px; max-height: 150px; overflow-y: auto; padding: 12px; background: #f9fafb; border-radius: 8px;">
                        <!-- 由 JS 渲染 -->
                    </div>
                    <button class="btn btn-primary" onclick="runProjectComparison()"
                        style="margin-top: 12px;">开始对比</button>
                </div>
                <div id="comparisonResult" style="display: none;">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">对比结果</div>
                        </div>
                        <div class="panel-body">
                            <div class="table-container">
                                <table class="table" id="comparisonTable">
                                    <thead>
                                        <tr id="comparisonHeader"></tr>
                                    </thead>
                                    <tbody id="comparisonBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('comparisonModal')">关闭</button>
            </div>
        </div>
    </div>


    <!-- AI配置列表模态框 (仅管理员) -->
    <div class="modal" id="aiConfigListModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>🤖 AI 配置管理</h3>
                <button class="modal-close" onclick="closeModal('aiConfigListModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px; display: flex; flex-wrap: wrap; gap: 8px;">
                    <button class="btn btn-primary btn-sm" onclick="showAIConfigModal()">+ 新增配置</button>
                    <button class="btn btn-outline btn-sm" onclick="migrateEnvConfigs()">📥 导入环境变量</button>
                    <button class="btn btn-outline btn-sm" onclick="loadAIConfigs()">🔄 刷新</button>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>名称</th>
                                <th>API 地址</th>
                                <th>密钥</th>
                                <th>模型</th>
                                <th>优先级</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="aiConfigTableBody">
                            <tr>
                                <td colspan="7" style="text-align:center;">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('aiConfigListModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 阶段缩放设置模态框 -->
    <div id="scaleModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <div class="modal-title" id="scaleModalTitle">调整工作量</div>
                <button class="close-modal" onclick="closeModal('scaleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">工作量/设备数量</label>
                    <input type="number" id="scaleQuantityInput" class="form-control" placeholder="请输入数量 (如: 150)">
                    <p style="font-size: 11px; color: var(--gray-500); margin-top: 8px;">系统将根据预设逻辑动态调整阶段的计划工期。</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('scaleModal')">取消</button>
                <button class="btn btn-primary" id="btnSubmitScale" onclick="submitScale()">应用调整</button>
            </div>
        </div>
    </div>

    <!-- 每日简报模态框 -->
    <div id="briefingModal" class="modal">
        <div class="modal-content" style="max-width: 720px;">
            <div class="modal-header"
                style="background:linear-gradient(135deg,#8b5cf6,#6366f1);color:white;border-radius:12px 12px 0 0;">
                <div class="modal-title" style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:22px;">📋</span>
                    <div>
                        <div style="font-size:17px;font-weight:700;">AI 全局晨会简报</div>
                        <div style="font-size:11px;opacity:0.8;margin-top:2px;">汇总所有活跃项目 · AI智能分析 · 一键推送企业微信</div>
                    </div>
                </div>
                <button class="close-modal" onclick="closeModal('briefingModal')"
                    style="color:white;font-size:24px;">&times;</button>
            </div>
            <div class="modal-body">
                <div id="briefingContent">
                    <div style="text-align:center;padding:40px;color:var(--gray-400);">
                        点击"晨会简报"按钮开始加载...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 企业微信配置模态框 -->
    <div id="wecomConfigModal" class="modal">
        <div class="modal-content" style="max-width: 520px;">
            <div class="modal-header"
                style="background:linear-gradient(135deg,#25d366,#128c7e);color:white;border-radius:12px 12px 0 0;">
                <div class="modal-title" style="display:flex;align-items:center;gap:10px;">
                    <span style="font-size:22px;">📤</span>
                    <div>
                        <div style="font-size:17px;font-weight:700;">企业微信推送配置</div>
                        <div style="font-size:11px;opacity:0.8;margin-top:2px;">配置 Webhook · 启用自动推送 · 每日晨会简报直达企微</div>
                    </div>
                </div>
                <button class="close-modal" onclick="closeModal('wecomConfigModal')"
                    style="color:white;font-size:24px;">&times;</button>
            </div>
            <div class="modal-body">
                <div id="wecomConfigContent">
                    <div style="text-align:center;padding:40px;color:var(--gray-400);">
                        加载配置中...
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 里程碑庆祝弹窗 -->
    <div id="celebrationModal" class="modal">
        <div class="modal-content"
            style="max-width: 450px; text-align: center; background: linear-gradient(135deg, #ffffff, #f0f4ff); border: 2px solid #6366f1; border-radius: 16px; overflow: hidden; padding: 30px;">
            <div style="font-size: 60px; margin-bottom: 20px; animation: bounce 1s infinite;">🎉</div>
            <h2 id="celebrationTitle" style="color: #4f46e5; margin-bottom: 10px; font-weight: 800;">里程碑达成！</h2>
            <p id="celebrationMsg" style="color: #64748b; margin-bottom: 24px; line-height: 1.6; font-size: 14px;"></p>
            <div
                style="background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px dashed #cbd5e1; margin-bottom: 24px; text-align: left;">
                <label style="display: block; font-size: 13px; color: #475569; margin-bottom: 8px; font-weight: 600;">✨
                    记录这一刻的心得/复盘：</label>
                <textarea id="celebrationRetro" placeholder="在这个阶段，我们遇到了什么挑战？是如何克服的？"
                    style="width: 100%; height: 80px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px; resize: none; background: white;"></textarea>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn-primary" onclick="submitMilestoneRetro()"
                    style="padding: 10px 24px; border-radius: 10px; background: linear-gradient(135deg, #4f46e5, #818cf8);">保存并开启新征程</button>
                <button class="btn btn-outline" onclick="closeCelebration()"
                    style="padding: 10px 24px; border-radius: 10px;">暂时跳过</button>
            </div>
        </div>
    </div>

    <div id="userInfoPanel"
        style="display: none; position: fixed; top: 70px; right: 20px; background: white; padding: 16px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 200; min-width: 200px;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4f46e5, #818cf8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;"
                id="userAvatar">U</div>
            <div>
                <div style="font-weight: 600;" id="userDisplayName">用户</div>
                <div style="font-size: 12px; color: #6b7280;" id="userRole">成员</div>
            </div>
        </div>
        <div id="adminSettingsBtn" style="display:none; margin-bottom:8px;">
            <button class="btn btn-outline btn-full" onclick="adminSettings.open()">🛠️ 系统配置</button>
        </div>
        <button class="btn btn-outline btn-full" onclick="doLogout()">退出登录</button>
    </div>

    <script src='/api/force_static/js/api.js?v=2'></script>
    <script src='/api/force_static/js/city_coords.js?v=2'></script>
    <script src='/api/force_static/js/main.js?v=2'></script>
    <script src='/api/force_static/js/kb_management.js?v=2'></script>
    <script src='/api/force_static/js/pdf_export.js?v=2'></script>
    <script src='/api/force_static/js/daily_report.js?v=2'></script>
    <script src='/api/force_static/js/standup.js?v=2'></script>
    <script src='/api/force_static/js/admin_settings.js?v=5'></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(reg => console.log('[PWA] Service Worker registered:', reg.scope))
                    .catch(err => console.warn('[PWA] Service Worker registration failed:', err));
            });
        }
        function toggleFunctionMenu() {
            const menuContent = document.getElementById('functionMenuContent');
            const icon = document.getElementById('menuToggleIcon');
            if (menuContent.style.display === 'none') {
                menuContent.style.display = 'flex';
                icon.style.transform = 'rotate(90deg)';
                icon.innerText = '▾';
            } else {
                menuContent.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.innerText = '▸';
            }
        }
    </script>
    <!-- 业务报表预测/预览弹窗 -->
    <div id="businessReportModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3 id="reportModalTitle">业务运行报告预览</h3>
                <div style="display:flex; gap:12px; align-items:center;">
                    <div class="report-controls" style="display:flex; gap:8px;">
                        <select id="reportYear" class="btn btn-outline btn-xs" style="width:80px;"></select>
                        <select id="reportMonth" class="btn btn-outline btn-xs" style="width:70px;">
                            <option value="">月度</option>
                            <option value="1">1月</option>
                            <option value="2">2月</option>
                            <option value="3">3月</option>
                            <option value="4">4月</option>
                            <option value="5">5月</option>
                            <option value="6">6月</option>
                            <option value="7">7月</option>
                            <option value="8">8月</option>
                            <option value="9">9月</option>
                            <option value="10">10月</option>
                            <option value="11">11月</option>
                            <option value="12">12月</option>
                        </select>
                        <select id="reportQuarter" class="btn btn-outline btn-xs" style="width:70px;">
                            <option value="">季度</option>
                            <option value="1">Q1</option>
                            <option value="2">Q2</option>
                            <option value="3">Q3</option>
                            <option value="4">Q4</option>
                        </select>
                        <button class="btn btn-primary btn-xs" onclick="refreshReportPreview()">生成预览</button>
                    </div>
                    <button class="btn btn-success btn-sm" onclick="exportReportToPdf()">导出 PDF</button>
                    <button class="modal-close" onclick="closeModal('businessReportModal')">&times;</button>
                </div>
            </div>
            <div class="modal-body" id="reportPreviewContent" style="background:#f1f5f9; padding:40px;">
                <!-- 真正的报告纸张样式 -->
                <div id="reportPaper" class="report-paper"
                    style="background:white; max-width:800px; margin:0 auto; padding:60px; box-shadow:0 0 20px rgba(0,0,0,0.1); color:#1e293b; font-family:'Segoe UI', system-ui, sans-serif;">
                    <div style="text-align:center; margin-bottom:40px;">
                        <h1 id="paperProjectName" style="font-size:28px; font-weight:800; margin-bottom:8px;">项目名称</h1>
                        <p id="paperReportPeriod"
                            style="font-size:16px; color:#64748b; text-transform:uppercase; letter-spacing:1px;">2024年3月
                            运行报表</p>
                    </div>

                    <div class="report-section-paper" style="margin-bottom:30px;">
                        <h3
                            style="border-bottom:2px solid #3b82f6; padding-bottom:8px; margin-bottom:16px; font-size:18px;">
                            一、 核心运行摘要 (AI 驱动)</h3>
                        <div id="aiBusinessSummary" class="markdown-content"
                            style="line-height:1.7; font-size:14px; color:#334155;">正在生成 AI 分析...</div>
                    </div>

                    <div class="report-section-paper" style="margin-bottom:30px;">
                        <h3
                            style="border-bottom:2px solid #3b82f6; padding-bottom:8px; margin-bottom:16px; font-size:18px;">
                            二、 交付进度与里程碑</h3>
                        <div id="periodMilestones" style="font-size:14px;"></div>
                        <div id="periodTasks" style="margin-top:12px; font-size:13px; color:#64748b;"></div>
                    </div>

                    <div class="report-section-paper" style="margin-bottom:30px;">
                        <h3
                            style="border-bottom:2px solid #3b82f6; padding-bottom:8px; margin-bottom:16px; font-size:18px;">
                            三、 财务健康度</h3>
                        <div id="periodFinancials"
                            style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; background:#f8fafc; padding:20px; border-radius:12px;">
                        </div>
                    </div>

                    <div
                        style="margin-top:60px; border-top:1px solid #e2e8f0; padding-top:20px; color:#94a3b8; font-size:12px; text-align:center;">
                        此报告由 ICU-PM 智能管控平台自动生成 | 数据截至: <span id="reportPrintDate"></span>
                    </div>
                </div>
            </div>
        </div>
        <!-- 风险链推演 (蝴蝶效应) 弹窗 -->
        <div id="riskSimulationModal" class="modal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>🦋 风险链推演 (延迟仿真)</h3>
                    <button class="modal-close" onclick="closeModal('riskSimulationModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="simulation-input"
                        style="display:flex; gap:12px; align-items:center; margin-bottom:20px; background:#f8fafc; padding:16px; border-radius:12px;">
                        <div>拟模拟任务: <b id="simTaskName">加载中...</b></div>
                        <div style="flex:1;">假设延期:
                            <input type="number" id="simDelayDays" value="3" min="1" max="99"
                                style="width:60px; padding:4px 8px; border:1px solid #cbd5e1; border-radius:6px;"> 天
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="runRiskSimulation()">开始推演</button>
                    </div>

                    <div id="simulationResult" style="display:none;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                            <div class="impact-list-panel">
                                <h4 style="font-size:14px; color:#64748b; margin-bottom:12px;">受波及的下游任务 (Top 10)</h4>
                                <div id="impactedTasksList"
                                    style="max-height:300px; overflow-y:auto; border:1px solid #e2e8f0; border-radius:8px;">
                                    <!-- 填充列表 -->
                                </div>
                            </div>
                            <div class="ai-narration-panel">
                                <h4 style="font-size:14px; color:#64748b; margin-bottom:12px;">蝴蝶效应深度分析 (AI)</h4>
                                <div id="simulationNarration" class="markdown-content"
                                    style="background:#fff7ed; padding:16px; border-radius:8px; border:1px solid #ffedd5; font-size:13px; line-height:1.6;">
                                    正在推演逻辑影响...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 项目快照 (新人入门) 弹窗 -->
        <div id="projectSnapshotModal" class="modal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>📸 项目极简快照 (新人手册)</h3>
                    <button class="modal-close" onclick="closeModal('projectSnapshotModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="snapshotContent" class="markdown-content"
                        style="background:#f8fafc; padding:24px; border-radius:12px; border:1px solid #e2e8f0; line-height:1.7;">
                        正在调取 AI 汇总项目概况...
                    </div>
                </div>
            </div>
        </div>

        <!-- 会议助理 (纪要提取) 弹窗 -->
        <div id="meetingAssistantModal" class="modal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>🎙️ AI 会议助理 (纪要与行动提取)</h3>
                    <button class="modal-close" onclick="closeModal('meetingAssistantModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <textarea id="meetingTranscript" placeholder="粘贴会议转写文本或速记内容..."
                        style="width:100%; height:150px; padding:12px; border:1px solid #cbd5e1; border-radius:8px; margin-bottom:16px; font-family:inherit;"></textarea>
                    <button class="btn btn-primary" onclick="extractMeetingActions()">提取纪要与待办</button>
                    <div id="meetingResult" class="markdown-content"
                        style="margin-top:20px; display:none; background:#f0f9ff; padding:20px; border-radius:12px; border:1px solid #bae6fd;">
                        <!-- 结果填充 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 批量补录 (Chat/Git 导入) 弹窗 -->
        <div id="multiLogImportModal" class="modal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>📝 批量智能补录 (Git/Chat 导入)</h3>
                    <button class="modal-close" onclick="closeModal('multiLogImportModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom:12px; font-size:13px; color:#64748b;">粘贴一段聊天记录或 Git Log，AI
                        将自动拆分为多条日报并填充到列表。</div>
                    <textarea id="multiLogSource" placeholder="粘贴一段长文本..."
                        style="width:100%; height:150px; padding:12px; border:1px solid #cbd5e1; border-radius:8px; margin-bottom:16px; font-family:inherit;"></textarea>
                    <button class="btn btn-primary" onclick="parseMultiLogs()">智能拆解并导入</button>
                    <div id="multiLogPreview" style="margin-top:20px; display:none;">
                        <h4 style="font-size:14px; margin-bottom:12px;">提取到的条目 (预览)</h4>
                        <div id="multiLogItems"
                            style="max-height:300px; overflow-y:auto; display:flex; flex-direction:column; gap:10px;">
                            <!-- 预览条目 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 接口 AI 助手 (Premium Modal) -->
        <div id="interfaceChatModal" class="modal">
            <div class="modal-content modal-large"
                style="height: 85vh; border-radius: 20px; border: none; overflow: hidden;">
                <div class="modal-header"
                    style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; border: none; padding: 20px 24px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div
                            style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            🤖</div>
                        <div>
                            <h3 style="margin:0; font-size: 18px; color: white;">接口 AI 助手</h3>
                            <div style="font-size: 12px; opacity: 0.8;">基于当前文档的接口查询与生成</div>
                        </div>
                    </div>
                    <button class="modal-close" onclick="closeModal('interfaceChatModal')"
                        style="background: rgba(255,255,255,0.2); color: white; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 20px;">&times;</button>
                </div>
                <div class="modal-body" style="background: #f8fafc; display: flex; flex-direction: column; padding: 0;">
                    <div id="modalChatMessages" class="ai-chat-messages"
                        style="flex: 1; padding: 24px; overflow-y: auto; background: #f8fafc; height: calc(85vh - 180px);">
                        <div class="ai-message assistant">
                            您好！我是您的接口 AI 特助。我已经加载了当前项目的接口规范。您可以问我：<br>
                            • “<span style="color:var(--primary);cursor:pointer;"
                                onclick="document.getElementById('modalChatInput').value='由于重症系统的入参要求，帮我生成一个创建手术申请的 JSON 请求体。';InterfaceSpec.sendChatMessage(true)">帮我生成一个创建手术申请的
                                JSON 请求体</span>”<br>
                            • “<span style="color:var(--primary);cursor:pointer;"
                                onclick="document.getElementById('modalChatInput').value='帮我汇总一下当前已上传文档的所有接口列表。';InterfaceSpec.sendChatMessage(true)">汇总当前所有接口列表</span>”<br>
                            • “<span style="color:var(--primary);cursor:pointer;"
                                onclick="document.getElementById('modalChatInput').value='比较一下我方标准和对方在排班接口上的字段差异。';InterfaceSpec.sendChatMessage(true)">比较我方与对方接口差异</span>”
                        </div>
                    </div>
                    <div style="padding: 20px; background: white; border-top: 1px solid #e2e8f0; flex-shrink: 0;">
                        <div style="display: flex; gap: 12px; align-items: flex-end;">
                            <textarea id="modalChatInput" placeholder="请输入您的问题..." rows="3"
                                style="flex: 1; border: 1.5px solid #e2e8f0; border-radius: 12px; padding: 12px 16px; font-size: 14px; resize: none; transition: all 0.2s;"
                                onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(99,102,241,0.1)'"
                                onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'"
                                onkeydown="if(event.keyCode==13 && !event.shiftKey){event.preventDefault(); InterfaceSpec.sendChatMessage(true);}"></textarea>
                            <button class="btn btn-primary" onclick="InterfaceSpec.sendChatMessage(true)"
                                style="height: 48px; padding: 0 24px; border-radius: 12px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                <span>发送</span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: #94a3b8; text-align: center;">AI
                            助手基于当前解析的结构化数据 provide 回答</div>
                    </div>
                </div>
            </div>
        </div>
</body>

</html>